# 主体报表CSV列名映射说明

## 概述

本文档说明了主体报表CSV文件的列名如何映射到数据库字段。系统会自动检测CSV文件中的列名，并根据关键词匹配到相应的数据库字段。

## 映射规则

### 基础字段

| 数据库字段 | 匹配关键词 | 说明 |
|-----------|-----------|------|
| `product_name` | 商品名称, 产品名称, 商品标题, 宝贝标题 | 商品名称 |
| `product_code` | 商品编码, 产品编码, 商品代码, 产品代码, id | 商品编码 |
| `category` | 类目, 分类, 品类, 类别 | 商品分类 |
| `brand` | 品牌, 品牌名称 | 品牌信息 |
| `supplier_name` | 供应商, 供应商名称, 商家, 卖家 | 供应商名称 |
| `shop_name` | 店铺, 店铺名称, 店名 | 店铺名称 |
| `plan_name` | 计划名称, 推广计划, 计划, 广告计划 | 推广计划名称 |

### 销售数据

| 数据库字段 | 匹配关键词 | 说明 |
|-----------|-----------|------|
| `sales_amount` | 销售金额, 销售额, 成交金额, 交易金额 | 销售金额 |
| `sales_quantity` | 销售数量, 销量, 成交数量, 交易数量 | 销售数量 |
| `refund_amount` | 退款金额, 退货金额, 退款 | 退款金额 |
| `refund_quantity` | 退款数量, 退货数量 | 退款数量 |
| `net_sales_amount` | 净销售额, 净销售金额, 净成交额 | 净销售金额 |
| `net_sales_quantity` | 净销量, 净销售数量, 净成交数量 | 净销售数量 |

### 成本和利润

| 数据库字段 | 匹配关键词 | 说明 |
|-----------|-----------|------|
| `cost_amount` | 成本, 成本金额, 成本价 | 成本金额 |
| `gross_profit` | 毛利, 毛利润 (不含"率") | 毛利润 |
| `gross_profit_rate` | 毛利率, 毛利润率 | 毛利率 |

### 推广数据

| 数据库字段 | 匹配关键词 | 说明 |
|-----------|-----------|------|
| `promotion_cost` | 推广费, 广告费, 推广费用, 广告费用, 推广成本, 广告成本 | 推广费用 |
| `promotion_clicks` | 点击量, 点击数, 点击次数 | 推广点击量 |
| `promotion_impressions` | 展现量, 展现数, 展现次数, 曝光量, 曝光数 | 推广展现量 |
| `promotion_ctr` | 点击率, CTR, ctr | 推广点击率 |
| `promotion_cpc` | 点击单价, CPC, cpc, 平均点击花费 | 推广点击单价 |
| `promotion_conversion_rate` | 推广转化率, 广告转化率, 转化率 (含"推广") | 推广转化率 |
| `promotion_roi` | roi, roas, 投入产出比, 投资回报率 | 推广投资回报率 |

### 流量数据

| 数据库字段 | 匹配关键词 | 说明 |
|-----------|-----------|------|
| `visitor_count` | 访客数, 访客量, 访问人数, 独立访客 | 访客数量 |
| `page_views` | 浏览量, 浏览数, 页面浏览量, PV, pv | 页面浏览量 |
| `bounce_rate` | 跳出率, 跳失率 | 跳出率 |
| `avg_visit_duration` | 访问时长, 平均访问时长, 停留时长, 平均停留时长 | 平均访问时长 |
| `conversion_rate` | 转化率 (不含"推广") | 转化率 |

### 库存数据

| 数据库字段 | 匹配关键词 | 说明 |
|-----------|-----------|------|
| `stock_quantity` | 库存数量, 库存量, 现有库存 | 库存数量 |
| `stock_value` | 库存价值, 库存金额 | 库存价值 |
| `stock_turnover` | 库存周转率, 周转率, 周转 | 库存周转率 |

### 评价数据

| 数据库字段 | 匹配关键词 | 说明 |
|-----------|-----------|------|
| `review_count` | 评价数, 评论数, 评价数量 | 评价数量 |
| `positive_review_rate` | 好评率, 正面评价率 | 好评率 |
| `avg_rating` | 平均评分, 评分, 平均分 | 平均评分 |

## 匹配逻辑

1. **精确匹配**: 系统会检查CSV列名是否包含上述关键词
2. **大小写不敏感**: 匹配时会忽略大小写
3. **优先级**: 更具体的关键词会优先匹配
4. **过滤功能**: 系统会过滤计划名称，只保留包含"五更"、"希臻"、"谦易律哲"的记录

## 调试信息

系统会在控制台输出以下调试信息：
- 检测到的CSV列名
- 映射结果
- 过滤的记录数量

## 常见问题

### 1. 列名无法识别
如果CSV文件中的列名无法被系统识别，请检查：
- 列名是否包含上述关键词
- 列名是否有多余的空格或特殊字符
- 列名的中文编码是否正确

### 2. 数据未被导入
如果数据未被导入，可能是因为：
- 计划名称过滤：数据不包含指定的关键词
- 列名映射失败：系统无法识别CSV列名
- 数据格式错误：数据类型不匹配

### 3. 如何添加新的列名映射
如果需要添加新的列名映射，请：
1. 修改 `get_subject_report_column_mapping()` 函数
2. 在相应的关键词列表中添加新的关键词
3. 重新部署系统

## 示例

假设CSV文件包含以下列名：
```
推广计划, 宝贝标题, 展现量, 点击量, 点击率, 点击单价, 成交金额, 推广费用
```

系统会自动映射为：
- `推广计划` → `plan_name`
- `宝贝标题` → `product_name`
- `展现量` → `promotion_impressions`
- `点击量` → `promotion_clicks`
- `点击率` → `promotion_ctr`
- `点击单价` → `promotion_cpc`
- `成交金额` → `sales_amount`
- `推广费用` → `promotion_cost` 