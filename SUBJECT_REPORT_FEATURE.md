# 主体报表功能说明

## 功能概述

在数据列表页面中，推广费用字段（关键词推广、全站推广、货品运营推广、人群推广、超级短视频、多目标直投）现在支持点击查看。点击后会弹出主体报表数据弹窗，显示对应的subject_report数据。

## 功能特点

### 1. 可点击的推广费用字段
- **关键词推广** (keyword_promotion)
- **全站推广** (sitewide_promotion)
- **货品运营推广** (product_operation)
- **人群推广** (crowd_promotion)
- **超级短视频** (super_short_video)
- **多目标直投** (multi_target_direct)

### 2. 数据关联
- 关联条件：`product_data_merge.upload_date = subject_report.report_date`
- 关联条件：`product_data_merge.tmall_product_code = subject_report.subject_id`

### 3. 弹窗功能
- 全屏弹窗显示
- 数据统计汇总
- 详细数据表格
- 数据导出功能

## 使用方法

### 1. 访问数据列表页面
1. 登录系统
2. 进入数据列表页面
3. 查看包含推广费用数据的行

### 2. 点击推广费用字段
1. 找到任意推广费用字段（显示为黄色链接）
2. 鼠标悬停查看提示信息
3. 点击字段查看主体报表数据

### 3. 查看主体报表数据
1. 弹窗会显示商品基本信息
2. 查看数据统计汇总
3. 浏览详细数据表格
4. 可选择导出数据

## 数据展示

### 1. 主体报表字段
弹窗会显示以下字段的详细数据：

| 字段类别 | 字段名称 |
|---------|---------|
| 基础信息 | 日期、场景名字、原二级场景名字、计划ID、计划名字、主体ID |
| 展现点击 | 展现量、点击量、花费、点击率、平均点击花费、千次展现花费 |
| 成交数据 | 直接成交金额、间接成交金额、总成交金额、总成交笔数、直接成交笔数、间接成交笔数 |
| 转化指标 | 点击转化率、投入产出比、总成交成本 |
| 购物车 | 总购物车数、直接购物车数、间接购物车数、加购率 |
| 收藏数据 | 收藏宝贝数、收藏店铺数、店铺收藏成本、总收藏加购数、总收藏加购成本、宝贝收藏加购数、宝贝收藏加购成本、总收藏数、宝贝收藏成本、宝贝收藏率、加购成本 |
| 订单数据 | 拍下订单笔数、拍下订单金额、直接收藏宝贝数、间接收藏宝贝数 |
| 咨询访问 | 旺旺咨询量、引导访问量、引导访问人数、引导访问潜客数、引导访问潜客占比、引导访问率、深度访问量、平均访问页面数 |
| 客户数据 | 成交新客数、成交新客占比、会员首购人数、会员成交金额、会员成交笔数、成交人数、人均成交笔数、人均成交金额 |
| 自然流量 | 自然流量转化金额、自然流量曝光量 |

### 2. 数据统计
弹窗顶部会显示关键指标的汇总统计：
- **总花费**：所有日期的推广费用总和
- **总展现量**：所有日期的展现量总和
- **总点击量**：所有日期的点击量总和
- **总成交金额**：所有日期的成交金额总和
- **总成交笔数**：所有日期的成交笔数总和
- **平均点击率**：总点击量/总展现量
- **平均点击花费**：总花费/总点击量
- **平均投入产出比**：总成交金额/总花费

## 技术实现

### 1. 后端API
- **端点**：`/api/subject-report/product/<tmall_product_code>`
- **方法**：GET
- **参数**：start_date, end_date（可选）
- **返回**：JSON格式的主体报表数据

### 2. 前端模块
- **模块**：SubjectReportModule
- **文件**：`frontend/js/modules/subjectReport.js`
- **功能**：弹窗显示、数据渲染、统计计算、数据导出

### 3. 数据关联逻辑
```javascript
// 查询条件
SubjectReport.query.filter(
    SubjectReport.subject_id == tmall_product_code,
    SubjectReport.report_date >= start_date,
    SubjectReport.report_date <= end_date
)
```

## 界面设计

### 1. 推广费用字段样式
- **颜色**：黄色 (#ffc107)
- **悬停效果**：下划线
- **提示信息**：点击查看主体报表数据

### 2. 弹窗布局
- **尺寸**：全屏弹窗
- **标题**：主体报表数据 - [商品ID] - [推广类型]
- **内容**：商品信息、数据统计、详细表格

### 3. 表格设计
- **响应式**：支持横向滚动
- **固定表头**：sticky-top样式
- **数据格式化**：数字千分位、金额保留2位小数、百分比保留2位小数

## 测试方法

### 1. 基本功能测试
1. 访问数据列表页面
2. 找到有推广费用数据的行
3. 点击任意推广费用字段
4. 验证弹窗是否正确显示

### 2. 数据准确性测试
1. 点击推广费用字段
2. 查看弹窗中的数据
3. 验证数据是否与数据库中的subject_report表一致
4. 检查关联条件是否正确

### 3. 统计计算测试
1. 查看弹窗顶部的统计信息
2. 手动计算关键指标
3. 对比系统显示的结果
4. 验证计算逻辑是否正确

### 4. 导出功能测试
1. 在弹窗中点击"导出数据"按钮
2. 检查下载的CSV文件
3. 验证文件内容是否完整
4. 确认文件格式是否正确

## 注意事项

### 1. 数据完整性
- 只有存在subject_report数据的商品才能正常显示
- 如果商品没有对应的主体报表数据，会显示"暂无主体报表数据"
- 关联条件必须完全匹配才能获取到数据

### 2. 性能考虑
- 弹窗使用全屏显示，适合查看大量数据
- 表格支持滚动，避免页面过长
- 数据加载时显示加载提示

### 3. 用户体验
- 推广费用字段有明显的视觉提示（黄色链接）
- 鼠标悬停显示操作提示
- 弹窗提供完整的操作功能（查看、导出、关闭）

## 扩展功能

未来可以考虑的扩展：
- 支持按日期范围筛选数据
- 添加数据可视化图表
- 支持多商品对比分析
- 添加数据钻取功能
- 支持自定义字段显示
- 添加数据导出格式选择 