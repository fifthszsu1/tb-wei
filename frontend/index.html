<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电商数据管理系统</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 250px;
            background: #2c3e50;
            color: white;
            padding-top: 60px;
            transition: transform 0.3s ease;
        }
        
        .sidebar.hidden {
            transform: translateX(-100%);
        }
        
        .sidebar .nav-link {
            color: #ecf0f1;
            padding: 15px 20px;
            border-radius: 0;
            transition: all 0.3s ease;
        }
        
        .sidebar .nav-link:hover {
            background: #34495e;
            color: white;
        }
        
        .sidebar .nav-link.active {
            background: #3498db;
            color: white;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
            padding-top: 80px; /* 为固定导航栏预留空间 */
            transition: margin-left 0.3s ease;
        }
        
        .main-content.expanded {
            margin-left: 0;
        }
        
        .page-content {
            min-height: 500px; /* 确保页面有足够高度 */
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding-top: 70px; /* 移动设备上稍微减少顶部间距 */
            }
            
            .sidebar {
                transform: translateX(-100%);
            }
        }
        
        /* 列宽调整样式 */
        .resizable-column {
            position: relative;
            user-select: none;
        }
        
        .resizable-column::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 6px;
            background: transparent;
            cursor: col-resize;
            z-index: 10;
        }
        
        .resizable-column:hover::after {
            background: rgba(0, 123, 255, 0.3);
        }
        
        .resizable-column.resizing::after {
            background: rgba(0, 123, 255, 0.6);
        }

        /* 产品标签页面列宽调整样式 */
        th[data-column] {
            position: relative;
            user-select: none;
        }
        
        th[data-column]:hover {
            background-color: #f8f9fa;
        }
        
        th[data-column].resizing {
            background-color: #e9ecef;
            border-right: 2px solid #007bff;
        }
        
        th[data-column]:before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            width: 6px;
            height: 100%;
            cursor: col-resize;
            z-index: 1;
        }

        /* 网盘路径悬停显示复制按钮 */
        .network-path-container:hover .network-path-copy-btn {
            opacity: 1;
        }
        
        .network-path-container:hover .network-path-text {
            padding-right: 30px; /* 为复制按钮留出空间 */
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        /* 活动状态样式 */
        .activity-item {
            margin-bottom: 4px;
            line-height: 1.3;
        }
        
        .activity-item:last-child {
            margin-bottom: 0;
        }
        
        .activity-status {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.85em;
            font-weight: 500;
            white-space: nowrap;
            display: inline-block;
        }
        
        .activity-warmup {
            background-color: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
        }
        
        .activity-active {
            background-color: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .table th {
            border-right: 1px solid #dee2e6;
            padding: 8px 6px;
            vertical-align: middle;
            white-space: nowrap;
        }
        
        .table td {
            border-right: 1px solid #dee2e6;
            padding: 8px 6px;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .navbar-brand {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .upload-zone {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-zone:hover {
            border-color: #3498db;
            background: #e3f2fd;
        }
        
        .upload-zone.dragover {
            border-color: #3498db;
            background: #e3f2fd;
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 10px 25px;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 1000;
            overflow: auto; /* 防止内容溢出 */
        }
        
        .login-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            margin: 20px; /* 添加边距以防止贴边 */
            position: relative;
            z-index: 1001;
        }
        
        /* 确保登录页面显示时隐藏其他元素的滚动条 */
        body.login-active {
            overflow: hidden;
        }

        /* 订单状态下拉菜单样式 - 确保不被遮挡 */
        .dropdown-menu {
            z-index: 1055 !important;
            position: absolute !important;
        }
        
        /* 确保下拉菜单显示在最上层 */
        .dropdown.show .dropdown-menu {
            z-index: 1055 !important;
        }

        /* 数据列表表格冻结列样式 */
        #dataPage .table-container {
            position: relative;
            overflow-x: auto;
            max-width: 100%;
            background: white;
        }
        
        #dataPage .table-container table {
            border-collapse: separate;
            border-spacing: 0;
            background: white;
        }
        
        /* 冻结列样式 - 只影响数据列表页面 */
        #dataPage .frozen-column {
            position: sticky !important;
            background: white !important;
            z-index: 10;
            box-shadow: 1px 0 0 0 #dee2e6;
            border-right: 1px solid #dee2e6 !important;
            background-clip: padding-box !important;
            /* 确保背景完全覆盖 */
            min-height: 100%;
            position: relative;
        }
        
        /* 为冻结列添加额外的背景层 - 只影响数据列表页面 */
        #dataPage .frozen-column::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: inherit;
            z-index: -1;
        }
        
        /* 表头冻结列样式 - 只影响数据列表页面 */
        #dataPage thead .frozen-column {
            position: sticky !important;
            background: #212529 !important;
            z-index: 12;
            top: 0;
            box-shadow: 1px 0 0 0 #dee2e6;
            border-right: 1px solid #454d55 !important;
            background-clip: padding-box !important;
            min-height: 100%;
        }
        
        /* 表头冻结列的额外背景层 - 只影响数据列表页面 */
        #dataPage thead .frozen-column::after {
            background: #212529 !important;
        }
        
        /* 冻结列位置将通过JavaScript动态计算 */
        
        /* 表头冻结列样式 */
        .table-dark .frozen-column {
            background: #212529 !important;
            z-index: 12;
        }
        
        /* 确保表头也能冻结 */
        .sticky-top .frozen-column {
            position: sticky !important;
            background: #212529 !important;
            z-index: 12;
        }
        
        /* 确保冻结列有边框 */
        .frozen-column {
            border-right: 2px solid #dee2e6;
        }
        
        /* 表格行悬停时冻结列背景 - 只影响数据列表页面 */
        #dataPage .table-hover tbody tr:hover .frozen-column {
            background-color: rgba(0,0,0,.075) !important;
            box-shadow: 1px 0 0 0 #dee2e6;
        }
        
        #dataPage .table-hover tbody tr:hover .frozen-column::after {
            background-color: rgba(0,0,0,.075) !important;
        }
        
        /* 条纹表格冻结列背景 - 只影响数据列表页面 */
        #dataPage .table-striped tbody tr:nth-of-type(odd) .frozen-column {
            background-color: rgba(0,0,0,.05) !important;
            box-shadow: 1px 0 0 0 #dee2e6;
        }
        
        #dataPage .table-striped tbody tr:nth-of-type(odd) .frozen-column::after {
            background-color: rgba(0,0,0,.05) !important;
        }
        
        /* 确保冻结列完全遮挡后面的内容 */
        #dataPage .table-container {
            overflow-x: auto;
            overflow-y: visible;
        }
        
        /* 为整个冻结区域添加背景遮挡（宽度由JavaScript动态计算） */
        /* 只对数据列表页面的表格容器生效 */
        #dataPage .table-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 990px; /* 初始宽度，将由JavaScript动态更新 */
            background: white;
            z-index: 5;
            pointer-events: none;
        }
        
        /* 确保冻结列在滚动时有正确的背景 */
        .table-container {
            position: relative;
        }
        
        /* 最后一个冻结列的特殊阴影效果 - 只影响数据列表页面 */
        #dataPage .frozen-column.last-frozen {
            box-shadow: 2px 0 8px rgba(0,0,0,0.15) !important;
            border-right: 2px solid #dee2e6 !important;
        }
        
        /* 加强冻结列的背景遮挡 - 只影响数据列表页面 */
        #dataPage .frozen-column::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: inherit;
            z-index: -1;
        }
        
        /* 表格行悬停时冻结列的边框 - 只影响数据列表页面 */
        #dataPage .table-hover tbody tr:hover .frozen-column {
            border-right: 2px solid #007bff;
        }

        /* 数据面板表格滚动条样式 */
        #dashboardPage .table-responsive {
            max-height: 600px;
            overflow-x: auto;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
        }

        /* 滚动条样式优化 */
        #dashboardPage .table-responsive::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        #dashboardPage .table-responsive::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        #dashboardPage .table-responsive::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        #dashboardPage .table-responsive::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* 表格头部固定 */
        #dashboardPage .table-responsive table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* 类目列悬停提示样式 */
        .category-cell {
            position: relative;
            cursor: help;
            max-width: 300px;
            min-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(0, 123, 255, 0.1);
            border: 1px solid rgba(0, 123, 255, 0.2);
        }
        
        .category-cell:hover {
            background: rgba(0, 123, 255, 0.15);
            border-color: rgba(0, 123, 255, 0.3);
        }
        
        /* 可点击的真实销售金额样式 */
        .clickable-real-amount {
            transition: all 0.2s ease;
        }
        
        .clickable-real-amount:hover {
            background: rgba(0, 123, 255, 0.1);
            border-radius: 4px;
            padding: 2px 4px;
            transform: scale(1.05);
        }
        
        /* 商品名称单元格样式 */
        .product-name-cell {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* 排序表头样式 */
        .sort-header {
            transition: all 0.2s ease;
        }
        
        .sort-header:hover {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .category-tooltip {
            position: absolute;
            background: #2c3e50;
            color: white;
            padding: 10px 14px;
            border-radius: 6px;
            font-size: 13px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            max-width: 400px;
            word-wrap: break-word;
            white-space: normal;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s, transform 0.3s;
            pointer-events: none;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .category-tooltip.show {
            opacity: 1;
            transform: translateY(0);
        }

        .category-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 20px;
            border: 6px solid transparent;
            border-top-color: #2c3e50;
        }

        /* 列选择器样式 */
        .column-selector {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .category-section {
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
        }

        .category-header {
            background: #e9ecef;
            color: #495057;
            font-weight: 600;
            padding: 8px 12px;
            margin: 0 0 8px 0;
            border-radius: 4px;
            font-size: 0.875rem;
        }

        .category-item {
            padding: 6px 12px;
            margin: 2px 0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            background: white;
            border: 1px solid #e9ecef;
        }

        .category-item:hover {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .category-item.disabled {
            background: #f5f5f5;
            color: #999;
            cursor: not-allowed;
            border-style: dashed;
        }

        .category-item.disabled:hover {
            background: #f5f5f5;
            border-color: #e9ecef;
        }

        .category-item .badge {
            margin-left: auto;
            font-size: 0.7rem;
        }

        .selected-columns {
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
            padding: 12px;
        }

        .selected-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin: 4px 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: move;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .selected-item:hover {
            border-color: #007bff;
            box-shadow: 0 2px 4px rgba(0, 123, 255, 0.1);
        }

        .selected-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .selected-item .drag-handle {
            color: #6c757d;
            margin-right: 8px;
            cursor: grab;
        }

        .selected-item .drag-handle:active {
            cursor: grabbing;
        }

        .selected-item .remove-btn {
            margin-left: auto;
            color: #dc3545;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .selected-item .remove-btn:hover {
            background: #f8d7da;
        }

        .drag-placeholder {
            height: 40px;
            border: 2px dashed #007bff;
            border-radius: 4px;
            margin: 4px 0;
            background: #f0f8ff;
        }

        .search-box {
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }

        /* 悬浮图片预览样式 */
        .image-hover-preview {
            position: fixed;
            z-index: 9999;
            background: white;
            border: 2px solid #007bff;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            padding: 8px;
            max-width: 400px;
            max-height: 400px;
            pointer-events: none;
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .image-hover-preview.show {
            opacity: 1;
            transform: scale(1);
        }

        .image-hover-preview img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 4px;
            display: block;
        }

        .image-hover-preview .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 200px;
            height: 200px;
            color: #666;
            font-size: 14px;
        }

        .image-hover-preview .error {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 200px;
            height: 200px;
            color: #dc3545;
            font-size: 14px;
            flex-direction: column;
        }

        /* 小图片悬停效果 */
        .image-container img:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        /* 门店详情表格样式优化 */
        #storeTableBody tr:hover {
            background-color: #f8f9fa !important;
        }

        #storeTableBody td {
            white-space: nowrap;
            font-size: 0.875rem;
            padding: 0.5rem 0.3rem;
        }

        #storeTableBody th {
            font-size: 0.8rem;
            padding: 0.5rem 0.3rem;
            text-align: center;
        }

        /* 表格响应式滚动 */
        .table-responsive {
            max-height: 600px;
            overflow-y: auto;
        }

        /* 强调重要数据的样式 */
        .text-success {
            font-weight: bold;
        }

        .text-warning {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- 登录页面 -->
    <div id="loginPage" class="login-container">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="login-card">
                        <div class="text-center mb-4">
                            <i class="fas fa-database fa-3x text-primary mb-3"></i>
                            <h2>电商数据管理系统</h2>
                            <p class="text-muted">请登录您的账户</p>
                        </div>
                        <form id="loginForm">
                            <div class="mb-3">
                                <label for="username" class="form-label">用户名</label>
                                <input type="text" class="form-control" id="username" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">密码</label>
                                <input type="password" class="form-control" id="password" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">登录</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 主应用页面 -->
    <div id="mainApp" style="display: none;">
        <!-- 顶部导航 -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
            <div class="container-fluid">
                <button class="btn btn-link" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <a class="navbar-brand" href="#">电商数据管理系统</a>
                <div class="navbar-nav ms-auto">
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user"></i> <span id="currentUser"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="AuthModule.logout()">
                                <i class="fas fa-sign-out-alt"></i> 退出登录
                            </a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 侧边栏 -->
        <nav class="sidebar" id="sidebar">
            <div class="pt-3">
                <ul class="nav nav-pills flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showPage('upload', event)">
                            <i class="fas fa-upload"></i> 文件上传
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('summary', event)">
                            <i class="fas fa-calculator"></i> 数据汇总
                        </a>
                    </li>
                    <li class="nav-item" id="productTagsNav" style="display: none;">
                        <a class="nav-link" href="#" onclick="showPage('productTags', event)">
                            <i class="fas fa-tags"></i> 产品标签
                        </a>
                    </li>
                    <li class="nav-item" id="dashboardNav" style="display: none;">
                        <a class="nav-link" href="#" onclick="showPage('dashboard', event)">
                            <i class="fas fa-chart-dashboard"></i> 数据面板
                        </a>
                    </li>
                    <li class="nav-item" id="dataNav" style="display: none;">
                        <a class="nav-link" href="#" onclick="showPage('data', event)">
                            <i class="fas fa-table"></i> 数据列表
                        </a>
                    </li>
                    <li class="nav-item" id="orderDataNav" style="display: none;">
                        <a class="nav-link" href="#" onclick="showPage('orderData', event)">
                            <i class="fas fa-shopping-cart"></i> 订单数据列表
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- 主内容区域 -->
        <main class="main-content" id="mainContent">
            <!-- 文件上传页面 -->
            <div id="uploadPage" class="page-content">
                <!-- 第一模块：通用数据 -->
                <div class="mb-5">
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-database text-primary me-3" style="font-size: 1.5rem;"></i>
                                <h4 class="mb-0 text-primary">通用数据</h4>
                            </div>
                            <hr class="mt-2 mb-4">
                        </div>
                    </div>
                    
                    <div class="row">
                        <!-- 产品总表导入 -->
                        <div class="col-lg-12 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-list"></i> 产品总表导入</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <p class="text-muted">
                                            <i class="fas fa-info-circle"></i>
                                            导入产品总表Excel文件，包含产品ID、商品名称、上架时间等信息。
                                            <span class="text-warning"><i class="fas fa-exclamation-triangle"></i> 
                                            注意：重复导入只会更新新的天猫ID，原有数据不会被覆盖。</span>
                                        </p>
                                    </div>
                                    <div class="row align-items-center">
                                        <div class="col-lg-8">
                                            <div class="upload-zone" id="productListUploadZone">
                                                <i class="fas fa-list-alt fa-2x text-muted mb-2"></i>
                                                <p class="mb-0">点击选择产品总表文件</p>
                                                <p class="text-muted small">支持 .xlsx, .xls 格式</p>
                                                <input type="file" id="productListFileInput" accept=".xlsx,.xls" style="display: none;">
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <button class="btn btn-success w-100" id="productListUploadBtn" disabled>
                                                <i class="fas fa-upload"></i> 导入产品总表
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 第二模块：商品销售 -->
                <div class="mb-5">
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-shopping-cart text-success me-3" style="font-size: 1.5rem;"></i>
                                <h4 class="mb-0 text-success">商品销售</h4>
                            </div>
                            <hr class="mt-2 mb-4">
                        </div>
                    </div>
                    
                    <div class="row">
                        <!-- 平台数据导入 -->
                        <div class="col-lg-4 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-chart-bar"></i> 平台数据导入</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <label for="platform" class="form-label">选择平台</label>
                                            <select class="form-select" id="platform">
                                                <option value="苏宁">苏宁</option>
                                                <option value="淘宝">淘宝</option>
                                                <option value="拼多多">拼多多</option>
                                                <option value="京东">京东</option>
                                                <option value="其他">其他</option>
                                            </select>
                                        </div>
                                        <div class="col-12">
                                            <label for="uploadDate" class="form-label">选择日期</label>
                                            <input type="date" class="form-control" id="uploadDate" required>
                                        </div>
                                        <div class="col-12">
                                            <label for="supplierStore" class="form-label">选择门店</label>
                                            <select class="form-select" id="supplierStore" required>
                                                <option value="">请选择门店</option>
                                                <option value="wugeng供应商">wugeng供应商</option>
                                                <option value="xizhen供应商">xizhen供应商</option>
                                                <option value="谦易律哲供应商">谦易律哲供应商</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mt-4">
                                        <div class="upload-zone" id="uploadZone">
                                            <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-2"></i>
                                            <p class="mb-0">点击选择文件或拖拽文件到此处</p>
                                            <p class="text-muted small">支持 .xlsx, .xls, .csv 格式</p>
                                            <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" style="display: none;">
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-primary w-100" id="uploadBtn" disabled>
                                            <i class="fas fa-upload"></i> 上传平台数据
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 主体报表导入 -->
                        <div class="col-lg-4 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-chart-line"></i> 主体报表导入</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <p class="text-muted">
                                            <i class="fas fa-info-circle"></i>
                                            导入主体报表文件，包含销售、成本、推广等综合数据。
                                        </p>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-12">
                                            <label for="subjectReportDate" class="form-label">选择报表日期</label>
                                            <input type="date" class="form-control" id="subjectReportDate" required>
                                        </div>
                                    </div>
                                    <div class="mt-4">
                                        <div class="upload-zone" id="subjectReportUploadZone">
                                            <i class="fas fa-chart-line fa-2x text-muted mb-2"></i>
                                            <p class="mb-0">点击选择主体报表文件</p>
                                            <p class="text-muted small">支持 .xlsx, .xls, .csv 格式</p>
                                            <input type="file" id="subjectReportFileInput" accept=".xlsx,.xls,.csv" style="display: none;">
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-info w-100" id="subjectReportUploadBtn" disabled>
                                            <i class="fas fa-upload"></i> 导入主体报表
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 种菜表格登记导入 -->
                        <div class="col-lg-4 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-seedling"></i> 种菜表格登记导入</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <p class="text-muted">
                                            <i class="fas fa-info-circle"></i>
                                            导入种菜表格登记Excel文件，系统会自动识别所有工作表并导入数据。
                                        </p>
                                    </div>
                                    <div class="mt-4">
                                        <div class="upload-zone" id="plantingRecordsUploadZone">
                                            <i class="fas fa-seedling fa-2x text-muted mb-2"></i>
                                            <p class="mb-0">点击选择种菜表格文件</p>
                                            <p class="text-muted small">支持 .xlsx, .xls 格式</p>
                                            <input type="file" id="plantingRecordsFileInput" accept=".xlsx,.xls" style="display: none;">
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-warning w-100" id="plantingRecordsUploadBtn" disabled>
                                            <i class="fas fa-upload"></i> 导入种菜表格
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 第三模块：订单模块 -->
                <div class="mb-5">
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-receipt text-warning me-3" style="font-size: 1.5rem;"></i>
                                <h4 class="mb-0 text-warning">订单模块</h4>
                            </div>
                            <hr class="mt-2 mb-4">
                        </div>
                    </div>
                    
                    <div class="row">
                        <!-- 订单详情导入 -->
                        <div class="col-lg-4 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-receipt"></i> 订单详情导入</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <p class="text-muted">
                                            <i class="fas fa-info-circle"></i>
                                            导入订单详情文件，包含订单号、商品信息、物流等详细数据。文件可包含多个日期的数据，系统会自动从"下单时间"字段提取日期。
                                        </p>
                                    </div>
                                    <div class="mt-4">
                                        <div class="upload-zone" id="orderDetailsUploadZone">
                                            <i class="fas fa-receipt fa-2x text-muted mb-2"></i>
                                            <p class="mb-0">点击选择订单详情文件</p>
                                            <p class="text-muted small">支持 .xlsx, .xls 格式</p>
                                            <input type="file" id="orderDetailsFileInput" accept=".xlsx,.xls" style="display: none;">
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-secondary w-100" id="orderDetailsUploadBtn" disabled>
                                            <i class="fas fa-upload"></i> 导入订单详情
                                        </button>
                                    </div>
                                    
                                    <!-- 进度显示区域 -->
                                    <div class="mt-3" id="orderDetailsProgressContainer" style="display: none;">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <small class="text-muted">处理进度</small>
                                            <small class="text-muted" id="orderDetailsProgressPercent">0%</small>
                                        </div>
                                        <div class="progress mb-2" style="height: 8px;">
                                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                                 role="progressbar" 
                                                 id="orderDetailsProgressBar" 
                                                 style="width: 0%">
                                            </div>
                                        </div>
                                        <div class="row text-center">
                                            <div class="col-4">
                                                <small class="text-muted">已处理</small><br>
                                                <small id="orderDetailsProcessedItems">0</small>
                                            </div>
                                            <div class="col-4">
                                                <small class="text-muted">总计</small><br>
                                                <small id="orderDetailsTotalItems">0</small>
                                            </div>
                                            <div class="col-4">
                                                <small class="text-muted">预计剩余</small><br>
                                                <small id="orderDetailsEstimatedTime">--</small>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-muted" id="orderDetailsProgressMessage">准备中...</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 产品定价导入 -->
                        <div class="col-lg-4 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-dollar-sign"></i> 产品定价导入</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <p class="text-muted">
                                            <i class="fas fa-info-circle"></i>
                                            导入产品定价文件，第一个Tab为公司成本价格（适配品牌分类、商品编码、产品名称、实际供货价、供应商），其他Tab为运营成本价格（适配品牌分类、商品编码、产品名称、供货价）。上传将覆盖现有数据。
                                        </p>
                                    </div>
                                    <div class="mt-4">
                                        <div class="upload-zone" id="productPricingUploadZone">
                                            <i class="fas fa-dollar-sign fa-2x text-muted mb-2"></i>
                                            <p class="mb-0">点击选择产品定价文件</p>
                                            <p class="text-muted small">支持 .xlsx, .xls 格式</p>
                                            <input type="file" id="productPricingFileInput" accept=".xlsx,.xls" style="display: none;">
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-success w-100" id="productPricingUploadBtn" disabled>
                                            <i class="fas fa-upload"></i> 导入产品定价
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 支付宝金额表导入 -->
                        <div class="col-lg-4 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-alipay text-primary"></i> 支付宝金额表导入</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <p class="text-muted">
                                            <i class="fas fa-info-circle"></i>
                                            导入支付宝金额CSV文件，支持按日期范围上传，相同日期的数据将被覆盖。
                                        </p>
                                    </div>
                                    <div class="row g-3 mb-4">
                                        <div class="col-6">
                                            <label for="alipayStartDate" class="form-label">开始日期</label>
                                            <input type="date" class="form-control" id="alipayStartDate" required>
                                        </div>
                                        <div class="col-6">
                                            <label for="alipayEndDate" class="form-label">结束日期</label>
                                            <input type="date" class="form-control" id="alipayEndDate" required>
                                        </div>
                                    </div>
                                    <div class="mt-4">
                                        <div class="upload-zone" id="alipayUploadZone">
                                            <i class="fas fa-file-csv fa-2x text-muted mb-2"></i>
                                            <p class="mb-0">点击选择支付宝金额CSV文件</p>
                                            <p class="text-muted small">支持 .csv 格式，从第5行开始读取列名</p>
                                            <input type="file" id="alipayFileInput" accept=".csv" style="display: none;">
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-primary w-100" id="alipayUploadBtn" disabled>
                                            <i class="fas fa-upload"></i> 导入支付宝金额
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 用户上传统计 -->
                <div class="row" id="userStats" style="display: none;">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> 
                            您已成功上传 <strong id="userUploadCount">0</strong> 个文件
                        </div>
                    </div>
                </div>
            </div>

            <!-- 数据汇总页面 -->
            <div id="summaryPage" class="page-content" style="display: none;">
                <div class="row justify-content-center">
                    <!-- 推广费用汇总 -->
                    <div class="col-lg-8 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h4><i class="fas fa-calculator"></i> 推广费用汇总计算</h4>
                                <p class="text-muted mb-0">根据选择的日期，自动计算并分配推广费用到各个推广类型</p>
                            </div>
                            <div class="card-body">
                                <!-- 日期选择 -->
                                <div class="row mb-4">
                                    <div class="col-md-6 mx-auto">
                                        <label for="summaryDate" class="form-label">
                                            <i class="fas fa-calendar-alt"></i> 选择计算日期
                                        </label>
                                        <input type="date" class="form-control form-control-lg" id="summaryDate" 
                                               placeholder="请选择要计算的日期">
                                        <div class="form-text">
                                            选择要进行推广费用汇总计算的日期
                                        </div>
                                    </div>
                                </div>

                                <!-- 计算按钮 -->
                                <div class="row mb-4">
                                    <div class="col-md-6 mx-auto text-center">
                                        <button class="btn btn-primary btn-lg" id="calculateSummaryBtn" disabled>
                                            <i class="fas fa-play"></i> 开始计算汇总
                                        </button>
                                    </div>
                                </div>

                                <!-- 说明信息 -->
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-info-circle"></i> 功能说明：</h6>
                                    <ul class="mb-0">
                                        <li>系统会自动将 <strong>product_data_merge</strong> 表与 <strong>subject_report</strong> 表进行关联</li>
                                        <li>根据场景名称自动分配推广费用：
                                            <ul>
                                                <li><span class="badge bg-primary">全站推广</span> → 全站推广费用</li>
                                                <li><span class="badge bg-success">关键词推广</span> → 关键词推广费用</li>
                                                <li><span class="badge bg-warning">货品运营</span> → 货品运营费用</li>
                                                <li><span class="badge bg-danger">人群推广</span> → 人群推广费用</li>
                                                <li><span class="badge bg-info">超级短视频</span> → 超级短视频费用</li>
                                                <li><span class="badge bg-secondary">多目标直投</span> → 多目标直投费用</li>
                                            </ul>
                                        </li>
                                        <li>匹配条件：相同日期 + 相同产品编码</li>
                                    </ul>
                                </div>

                                <!-- 计算结果显示区域 -->
                                <div id="summaryResults" style="display: none;">
                                    <hr>
                                    <h5><i class="fas fa-chart-bar"></i> 计算结果</h5>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 种菜汇总 -->
                    <div class="col-lg-8 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h4><i class="fas fa-seedling"></i> 种菜数据汇总计算</h4>
                                <p class="text-muted mb-0">根据选择的日期，自动计算种菜订单数量、金额和成本</p>
                            </div>
                            <div class="card-body">
                                <!-- 日期选择 -->
                                <div class="row mb-4">
                                    <div class="col-md-6 mx-auto">
                                        <label for="plantingSummaryDate" class="form-label">
                                            <i class="fas fa-calendar-alt"></i> 选择计算日期
                                        </label>
                                        <input type="date" class="form-control form-control-lg" id="plantingSummaryDate" 
                                               placeholder="请选择要计算的日期">
                                        <div class="form-text">
                                            选择要进行种菜数据汇总计算的日期
                                        </div>
                                    </div>
                                </div>

                                <!-- 计算按钮 -->
                                <div class="row mb-4">
                                    <div class="col-md-6 mx-auto text-center">
                                        <button class="btn btn-success btn-lg" id="calculatePlantingSummaryBtn" disabled>
                                            <i class="fas fa-play"></i> 开始计算种菜汇总
                                        </button>
                                    </div>
                                </div>

                                <!-- 说明信息 -->
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-info-circle"></i> 功能说明：</h6>
                                    <ul class="mb-0">
                                        <li>系统会自动将 <strong>product_data_merge</strong> 表与 <strong>planting_records</strong> 表进行关联</li>
                                        <li>匹配条件：相同日期 + 相同产品编码</li>
                                        <li>计算内容：
                                            <ul>
                                                <li><span class="badge bg-primary">订单数量</span> → 匹配到的种菜订单数</li>
                                                <li><span class="badge bg-success">订单金额</span> → 种菜订单总金额</li>
                                                <li><span class="badge bg-warning">佣金总额</span> → 种菜佣金总额</li>
                                                <li><span class="badge bg-danger">物流成本</span> → 订单数 × 2.5</li>
                                                <li><span class="badge bg-info">扣款金额</span> → 总金额 × 0.08</li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>

                                <!-- 计算结果显示区域 -->
                                <div id="plantingSummaryResults" style="display: none;">
                                    <hr>
                                    <h5><i class="fas fa-chart-bar"></i> 计算结果</h5>
                                    
                                    <!-- 基本统计 -->
                                    <div class="row mb-3">
                                        <div class="col-md-3">
                                            <div class="card text-center">
                                                <div class="card-body">
                                                    <h3 class="text-primary" id="processedCount">0</h3>
                                                    <small>处理记录数</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card text-center">
                                                <div class="card-body">
                                                    <h3 class="text-success" id="matchedCount">0</h3>
                                                    <small>匹配记录数</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card text-center">
                                                <div class="card-body">
                                                    <h3 class="text-warning" id="updatedCount">0</h3>
                                                    <small>更新记录数</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card text-center">
                                                <div class="card-body">
                                                    <h3 class="text-info" id="errorCount">0</h3>
                                                    <small>错误记录数</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 场景费用分布 -->
                                    <div class="card">
                                        <div class="card-header">
                                            <h6><i class="fas fa-chart-pie"></i> 场景费用分布</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>场景名称</th>
                                                            <th>记录数量</th>
                                                            <th>总费用 (元)</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="sceneDistributionTable">
                                                        <!-- 动态生成 -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 错误信息 -->
                                    <div id="errorMessages" class="mt-3" style="display: none;">
                                        <div class="alert alert-warning">
                                            <h6><i class="fas fa-exclamation-triangle"></i> 处理错误：</h6>
                                            <ul id="errorList" class="mb-0">
                                                <!-- 错误信息将动态添加 -->
                                            </ul>
                                        </div>
                                    </div>

                                    <!-- 操作按钮 -->
                                    <div class="text-center mt-4">
                                        <button class="btn btn-outline-primary" onclick="showPage('data', event)">
                                            <i class="fas fa-table"></i> 查看数据列表
                                        </button>
                                        <button class="btn btn-outline-success" onclick="window.open('/api/merge-data?upload_date=' + document.getElementById('summaryDate').value, '_blank')">
                                            <i class="fas fa-external-link-alt"></i> 查看合并数据
                                        </button>
                                    </div>
                                </div>

                                <!-- 计算进度 -->
                                <div id="calculationProgress" style="display: none;">
                                    <hr>
                                    <div class="text-center">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">计算中...</span>
                                        </div>
                                        <p class="mt-2">正在计算推广费用汇总，请稍候...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- 最终汇总 -->
                    <div class="col-lg-8 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h4><i class="fas fa-calculator"></i> 最终数据汇总计算</h4>
                                <p class="text-muted mb-0">根据选择的日期，计算所有业务指标和毛利数据</p>
                            </div>
                            <div class="card-body">
                                <!-- 日期选择 -->
                                <div class="row mb-4">
                                    <div class="col-md-6 mx-auto">
                                        <label for="finalSummaryDate" class="form-label">
                                            <i class="fas fa-calendar-alt"></i> 选择计算日期
                                        </label>
                                        <input type="date" class="form-control form-control-lg" id="finalSummaryDate" 
                                               placeholder="请选择要计算的日期">
                                        <div class="form-text">
                                            选择要进行最终数据汇总计算的日期
                                        </div>
                                    </div>
                                </div>

                                <!-- 计算按钮 -->
                                <div class="row mb-4">
                                    <div class="col-md-6 mx-auto text-center">
                                        <button class="btn btn-primary btn-lg" id="calculateFinalSummaryBtn" disabled>
                                            <i class="fas fa-play"></i> 开始计算最终汇总
                                        </button>
                                    </div>
                                </div>

                                <!-- 说明信息 -->
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-info-circle"></i> 功能说明：</h6>
                                    <ul class="mb-0">
                                        <li>系统会计算以下指标：
                                            <ul>
                                                <li><span class="badge bg-primary">转化率指标</span> → 支付转化率、收藏率、加购率</li>
                                                <li><span class="badge bg-success">价值指标</span> → UV价值、真实转化率</li>
                                                <li><span class="badge bg-warning">真实数据</span> → 真实金额、真实买家数、真实件数</li>
                                                <li><span class="badge bg-danger">成本费用</span> → 产品成本、订单扣点、税票、物流成本</li>
                                                <li><span class="badge bg-info">最终毛利</span> → 计算所有收入和成本的差额</li>
                                            </ul>
                                        </li>
                                        <li>计算依赖：
                                            <ul>
                                                <li>商品排行数据（访客数、订单数等基础数据）</li>
                                                <li>种菜汇总数据（种菜订单、金额等）</li>
                                                <li>推广费用数据（各类推广费用）</li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>

                                <!-- 计算结果显示区域 -->
                                <div id="finalSummaryResults" style="display: none;">
                                    <hr>
                                    <h5><i class="fas fa-chart-bar"></i> 计算结果</h5>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 分割线 -->
                    <div class="col-12 mb-4">
                        <hr class="border-primary" style="border-width: 2px;">
                        <div class="text-center">
                            <span class="badge bg-primary px-3 py-2" style="font-size: 0.9rem;">
                                <i class="fas fa-shopping-cart"></i> 订单详情汇总计算模块
                            </span>
                        </div>
                        <hr class="border-primary" style="border-width: 2px;">
                    </div>

                    <!-- 订单详情汇总计算 -->
                    <div class="col-lg-8">
                        <div class="card border-primary">
                            <div class="card-header bg-primary text-white">
                                <h4><i class="fas fa-shopping-cart"></i> 订单详情汇总计算</h4>
                                <p class="mb-0">三步汇总：1）订单详情与产品总表关联  2）关联运营成本价格表  3）更新支付宝金额</p>
                            </div>
                            <div class="card-body">
                                <!-- 日期区间选择 -->
                                <div class="row mb-4">
                                    <div class="col-md-8 mx-auto">
                                        <label class="form-label">
                                            <i class="fas fa-calendar-alt"></i> 选择计算日期区间
                                        </label>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label for="orderDetailsSummaryStartDate" class="form-label">开始日期</label>
                                                <input type="date" class="form-control form-control-lg" id="orderDetailsSummaryStartDate" 
                                                       placeholder="请选择开始日期">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="orderDetailsSummaryEndDate" class="form-label">结束日期</label>
                                                <input type="date" class="form-control form-control-lg" id="orderDetailsSummaryEndDate" 
                                                       placeholder="请选择结束日期">
                                            </div>
                                        </div>
                                        <div class="form-text">
                                            选择要进行订单详情汇总计算的日期区间（根据订单下单时间匹配）
                                        </div>
                                    </div>
                                </div>

                                <!-- 三步计算按钮 -->
                                <div class="row mb-4">
                                    <div class="col-md-8 mx-auto">
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-outline-primary btn-lg" id="calculateOrderDetailsMergeBtn" disabled>
                                                <i class="fas fa-link"></i> 第一步：关联产品总表
                                            </button>
                                            <button class="btn btn-outline-success btn-lg" id="calculateOrderCostSummaryBtn" disabled>
                                                <i class="fas fa-calculator"></i> 第二步：计算成本汇总
                                            </button>
                                            <button class="btn btn-primary btn-lg" id="calculateOrderPaymentUpdateBtn" disabled>
                                                <i class="fas fa-credit-card"></i> 第三步：更新支付金额
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- 说明信息 -->
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-info-circle"></i> 功能说明：</h6>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <strong>第一步 - 订单详情关联：</strong>
                                            <ul class="mb-0">
                                                <li><span class="badge bg-primary">order_details</span> ← <span class="badge bg-success">product_list</span></li>
                                                <li>匹配条件：店铺款式编码 = 天猫供销ID</li>
                                                <li>根据日期区间匹配订单时间</li>
                                                <li>结果存储到 <strong>order_details_merge</strong> 表</li>
                                            </ul>
                                        </div>
                                        <div class="col-md-4">
                                            <strong>第二步 - 成本汇总计算：</strong>
                                            <ul class="mb-0">
                                                <li><span class="badge bg-warning">order_details_merge</span> ← <span class="badge bg-danger">operation_cost_pricing</span></li>
                                                <li>匹配条件：操作人 = 运营人员 AND 商品编码</li>
                                                <li>计算产品成本、物流成本、扣点、税票</li>
                                                <li>计算毛利、利润率等业务指标</li>
                                            </ul>
                                        </div>
                                        <div class="col-md-4">
                                            <strong>第三步 - 更新支付金额：</strong>
                                            <ul class="mb-0">
                                                <li><span class="badge bg-warning">order_details_merge</span> ← <span class="badge bg-info">alipay_amount</span></li>
                                                <li>匹配条件：线上订单号 = 支付宝订单号</li>
                                                <li>汇总支付宝收入和支出金额</li>
                                                <li>更新 <strong>paid_amount</strong> 字段</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <!-- 计算结果显示区域 -->
                                <div id="orderDetailsSummaryResults" style="display: none;">
                                    <hr>
                                    <h5><i class="fas fa-chart-bar"></i> 计算结果</h5>
                                    
                                    <!-- 第一步结果 -->
                                    <div id="step1Results" style="display: none;">
                                        <h6 class="text-primary"><i class="fas fa-link"></i> 第一步：订单详情关联结果</h6>
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <div class="card text-center border-primary">
                                                    <div class="card-body">
                                                        <h4 class="text-primary" id="step1ProcessedCount">0</h4>
                                                        <small>处理订单数</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="card text-center border-success">
                                                    <div class="card-body">
                                                        <h4 class="text-success" id="step1MatchedCount">0</h4>
                                                        <small>匹配产品总表</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="card text-center border-info">
                                                    <div class="card-body">
                                                        <h4 class="text-info" id="step1CreatedCount">0</h4>
                                                        <small>创建合并记录</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 第二步结果 -->
                                    <div id="step2Results" style="display: none;">
                                        <h6 class="text-primary"><i class="fas fa-calculator"></i> 第二步：成本汇总计算结果</h6>
                                        <div class="row mb-3">
                                            <div class="col-md-3">
                                                <div class="card text-center border-primary">
                                                    <div class="card-body">
                                                        <h4 class="text-primary" id="step2ProcessedCount">0</h4>
                                                        <small>处理记录数</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="card text-center border-success">
                                                    <div class="card-body">
                                                        <h4 class="text-success" id="step2CostMatchedCount">0</h4>
                                                        <small>匹配运营成本</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="card text-center border-warning">
                                                    <div class="card-body">
                                                        <h4 class="text-warning" id="step2UpdatedCount">0</h4>
                                                        <small>更新记录数</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="card text-center border-info">
                                                    <div class="card-body">
                                                        <h4 class="text-info" id="step2CostCalculatedCount">0</h4>
                                                        <small>计算成本数</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 第三步结果 -->
                                    <div id="step3Results" style="display: none;">
                                        <h6 class="text-primary"><i class="fas fa-credit-card"></i> 第三步：支付金额更新结果</h6>
                                        <div class="row mb-3">
                                            <div class="col-md-3">
                                                <div class="card text-center border-primary">
                                                    <div class="card-body">
                                                        <h4 class="text-primary" id="step3ProcessedCount">0</h4>
                                                        <small>处理记录数</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="card text-center border-success">
                                                    <div class="card-body">
                                                        <h4 class="text-success" id="step3MatchedCount">0</h4>
                                                        <small>匹配支付宝</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="card text-center border-warning">
                                                    <div class="card-body">
                                                        <h4 class="text-warning" id="step3UpdatedCount">0</h4>
                                                        <small>更新金额数</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="card text-center border-info">
                                                    <div class="card-body">
                                                        <h4 class="text-info" id="step3TotalAmount">0</h4>
                                                        <small>处理总金额</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 加载中显示 -->
                                <div id="orderDetailsCalculatingIndicator" style="display: none;">
                                    <div class="text-center">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">计算中...</span>
                                        </div>
                                        <p class="mt-2">正在计算订单详情汇总，请稍候...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 产品标签页面 -->
            <div id="productTagsPage" class="page-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <h4><i class="fas fa-tags"></i> 产品标签</h4>
                            </div>
                            <div class="col-md-9">
                                <div class="row g-2 align-items-end">
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">产品ID</label>
                                        <input type="text" class="form-control form-control-sm" id="productIdFilter" placeholder="输入产品ID">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">产品名称</label>
                                        <input type="text" class="form-control form-control-sm" id="productNameTagFilter" placeholder="输入产品名称">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">上架时间</label>
                                        <input type="date" class="form-control form-control-sm" id="listingTimeFilter" placeholder="选择上架时间">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">天猫供销ID</label>
                                        <input type="text" class="form-control form-control-sm" id="tmallSupplierIdFilter" placeholder="输入天猫供销ID">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">操作人</label>
                                        <input type="text" class="form-control form-control-sm" id="operatorFilter" placeholder="输入操作人">
                                    </div>
                                </div>
                                <div class="row g-2 align-items-end mt-1">
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">类目</label>
                                        <input type="text" class="form-control form-control-sm" id="categoryFilter" placeholder="输入类目">
                                    </div>
                                    <div class="col-md-10">
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-primary btn-sm" onclick="ProductTagsModule.searchData()">
                                                <i class="fas fa-search"></i> 搜索
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="ProductTagsModule.resetFilters()">
                                                <i class="fas fa-undo"></i> 重置
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- 表格工具栏 -->
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="d-flex align-items-center">
                                    <label for="productTagsPageSize" class="form-label me-2 mb-0">显示条数:</label>
                                    <select class="form-select form-select-sm me-3" id="productTagsPageSize" style="width: auto;" onchange="ProductTagsModule.changePageSize()">
                                        <option value="10">10</option>
                                        <option value="20" selected>20</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                    <span class="text-muted" id="productTagsDataInfo">显示 0 条记录</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <!-- 批量操作区域 -->
                                <div class="d-flex align-items-center justify-content-center">
                                    <span class="text-muted me-2" id="selectedCount">已选择 0 项</span>
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="ProductTagsModule.selectAll()" id="selectAllBtn">
                                            <i class="fas fa-check-square"></i> 全选
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="ProductTagsModule.clearSelection()" id="clearSelectionBtn">
                                            <i class="fas fa-square"></i> 取消
                                        </button>
                                        <button type="button" class="btn btn-success btn-sm" onclick="ProductTagsModule.showBatchTagModal()" id="batchTagBtn" disabled>
                                            <i class="fas fa-tags"></i> 批量打标
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="ProductTagsModule.refreshData()">
                                        <i class="fas fa-sync-alt"></i> 刷新
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 数据表格 -->
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th style="width: 50px; cursor: col-resize;" data-column="checkbox" onmousedown="ProductTagsModule.handleColumnResize(event)">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="masterCheckbox" onchange="ProductTagsModule.toggleAllSelection(this.checked)">
                                                <label class="form-check-label" for="masterCheckbox"></label>
                                            </div>
                                        </th>
                                        <th style="width: 80px; cursor: col-resize;" data-column="main_image" onmousedown="ProductTagsModule.handleColumnResize(event)">链接主图</th>
                                        <th style="width: 120px; cursor: col-resize;" data-column="product_id" onmousedown="ProductTagsModule.handleColumnResize(event)">产品ID</th>
                                        <th style="width: 200px; cursor: col-resize;" data-column="product_name" onmousedown="ProductTagsModule.handleColumnResize(event)">产品名称</th>
                                        <th style="width: 120px; cursor: col-resize;" data-column="listing_time" onmousedown="ProductTagsModule.handleColumnResize(event)">上架时间</th>
                                        <th style="width: 140px; cursor: col-resize;" data-column="tmall_supplier_id" onmousedown="ProductTagsModule.handleColumnResize(event)">天猫供销ID</th>
                                        <th style="width: 120px; cursor: col-resize;" data-column="category" onmousedown="ProductTagsModule.handleColumnResize(event)">类目</th>
                                        <th style="width: 250px; cursor: col-resize;" data-column="network_path" onmousedown="ProductTagsModule.handleColumnResize(event)">网盘路径</th>
                                        <th style="width: 100px; cursor: col-resize;" data-column="operator" onmousedown="ProductTagsModule.handleColumnResize(event)">操作人</th>
                                        <th style="width: 200px; cursor: col-resize;" data-column="action_list" onmousedown="ProductTagsModule.handleColumnResize(event)">活动列表</th>
                                        <th style="width: 100px; cursor: col-resize;" data-column="actions" onmousedown="ProductTagsModule.handleColumnResize(event)">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="productTagsTableBody">
                                    <tr>
                                        <td colspan="11" class="text-center text-muted">
                                            <i class="fas fa-spinner fa-spin"></i> 加载中...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- 分页 -->
                        <nav aria-label="产品标签分页">
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    <span class="text-muted" id="productTagsPaginationInfo">第 0 页，共 0 页</span>
                                </div>
                                <div class="col">
                                    <ul class="pagination pagination-sm justify-content-center mb-0" id="productTagsPagination">
                                        <!-- 分页按钮将在这里动态生成 -->
                                    </ul>
                                </div>
                            </div>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- 活动编辑模态框 -->
            <div class="modal fade" id="actionEditModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">编辑活动列表</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">产品ID</label>
                                    <input type="text" class="form-control" id="editProductId" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">产品名称</label>
                                    <input type="text" class="form-control" id="editProductName" readonly>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6>活动列表</h6>
                                <button type="button" class="btn btn-primary btn-sm" onclick="ProductTagsModule.addNewAction()">
                                    <i class="fas fa-plus"></i> 新增活动
                                </button>
                            </div>
                            
                            <div id="actionListContainer">
                                <!-- 活动列表将在这里动态生成 -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary" onclick="ProductTagsModule.saveActions()">保存</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 批量打标模态框 -->
            <div class="modal fade" id="batchTagModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">批量打标</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i>
                                    已选择 <span id="batchSelectedCount">0</span> 个产品进行批量打标
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label class="form-label">活动名称 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="batchActionName" placeholder="请输入活动名称">
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label class="form-label">预热时间 <span class="text-muted">(可选)</span></label>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <input type="date" class="form-control" id="batchWarmupDate">
                                        </div>
                                        <div class="col-3">
                                            <select class="form-select" id="batchWarmupHour">
                                                <!-- 小时选项将通过JS生成 -->
                                            </select>
                                        </div>
                                        <div class="col-3">
                                            <select class="form-select" id="batchWarmupMinute">
                                                <!-- 分钟选项将通过JS生成 -->
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">开始时间 <span class="text-danger">*</span></label>
                                    <div class="row g-2">
                                        <div class="col-12 mb-2">
                                            <input type="date" class="form-control" id="batchStartDate" required>
                                        </div>
                                        <div class="col-6">
                                            <select class="form-select" id="batchStartHour">
                                                <!-- 小时选项将通过JS生成 -->
                                            </select>
                                        </div>
                                        <div class="col-6">
                                            <select class="form-select" id="batchStartMinute">
                                                <!-- 分钟选项将通过JS生成 -->
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">结束时间 <span class="text-danger">*</span></label>
                                    <div class="row g-2">
                                        <div class="col-12 mb-2">
                                            <input type="date" class="form-control" id="batchEndDate" required>
                                        </div>
                                        <div class="col-6">
                                            <select class="form-select" id="batchEndHour">
                                                <!-- 小时选项将通过JS生成 -->
                                            </select>
                                        </div>
                                        <div class="col-6">
                                            <select class="form-select" id="batchEndMinute">
                                                <!-- 分钟选项将通过JS生成 -->
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-success" onclick="ProductTagsModule.saveBatchTags()">确定打标</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 数据面板页面 -->
            <div id="dashboardPage" class="page-content" style="display: none;">
                <!-- 日期选择器 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-calendar-alt"></i> 数据查询</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <label for="dashboardStartDate" class="form-label">开始日期</label>
                                <input type="date" class="form-control" id="dashboardStartDate">
                            </div>
                            <div class="col-md-3">
                                <label for="dashboardEndDate" class="form-label">结束日期</label>
                                <input type="date" class="form-control" id="dashboardEndDate">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <!-- 前一天按钮 -->
                                    <button class="btn btn-outline-danger" onclick="ChartsModule.loadPreviousDay()" title="查询前一天">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <!-- 后一天按钮 -->
                                    <button class="btn btn-outline-danger" onclick="ChartsModule.loadNextDay()" title="查询后一天">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                    <!-- 查询按钮 -->
                                    <button class="btn btn-primary" onclick="ChartsModule.loadCustomDateRange()">
                                        <i class="fas fa-search"></i> 查询
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="ChartsModule.resetToDefault()">
                                        <i class="fas fa-undo"></i> 重置
                                    </button>
                                </div>
                                <div class="mt-1">
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle"></i> 点击 <i class="fas fa-chevron-left"></i> <i class="fas fa-chevron-right"></i> 可以翻前一天和后一天
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-muted small mt-4">
                                    <i class="fas fa-info-circle"></i> 
                                    默认显示昨天数据，可选择日期区间查询
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 统计卡片 -->
                <div class="row">
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6>总销售金额</h6>
                                    <h2 id="totalAmount">¥0</h2>
                                    <small class="text-muted" id="dateRange">昨天</small>
                                </div>
                                <i class="fas fa-yen-sign fa-2x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6>真实销售金额</h6>
                                    <h2 id="totalRealAmount">¥0</h2>
                                    <small class="text-muted">去除退款和种菜</small>
                                </div>
                                <i class="fas fa-coins fa-2x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6>总销售件数</h6>
                                    <h2 id="totalQuantity">0</h2>
                                    <small class="text-muted">件</small>
                                </div>
                                <i class="fas fa-boxes fa-2x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6>平均客单价</h6>
                                    <h2 id="overallUnitPrice">¥0</h2>
                                    <small class="text-muted">每件</small>
                                </div>
                                <i class="fas fa-calculator fa-2x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6>门店数量</h6>
                                    <h2 id="storeCount">0</h2>
                                    <small class="text-muted">家</small>
                                </div>
                                <i class="fas fa-store fa-2x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 门店销售数据图表和表格 -->
                <div class="row mt-4">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-bar"></i> 门店销售金额排行</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="storeAmountChart" style="height: 400px;"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-pie"></i> 门店销售占比</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="storePieChart" style="height: 400px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 门店详细数据表格 -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-table"></i> 门店销售详情</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>排名</th>
                                                <th>门店名称</th>
                                                <th>销售金额</th>
                                                <th>真实销售金额</th>
                                                <th>销售件数</th>
                                                <th>客单价</th>
                                                <th>访客数</th>
                                                <th>支付买家数</th>
                                                <th>支付转化率</th>
                                                <th>种菜笔数</th>
                                                <th>种菜金额</th>
                                                <th>全站推广</th>
                                                <th>关键词推广</th>
                                                <th>货品运营推广</th>
                                                <th>人群推广费用</th>
                                                <th>超级短视频</th>
                                                <th>多目标直投</th>
                                                <th>推广总金额</th>
                                                <th>推广占比</th>
                                                <th>数据记录数</th>
                                            </tr>
                                        </thead>
                                        <tbody id="storeTableBody">
                                            <tr>
                                                <td colspan="20" class="text-center text-muted">
                                                    <i class="fas fa-spinner fa-spin"></i> 加载中...
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 负责人员销售详情表格 -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-users"></i> 负责人员销售详情</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>排名</th>
                                                <th>负责小队</th>
                                                <th>负责人员</th>
                                                <th>销售金额</th>
                                                <th>真实销售金额</th>
                                                <th>销售件数</th>
                                                <th>客单价</th>
                                                <th>访客数</th>
                                                <th>支付买家数</th>
                                                <th>支付转化率</th>
                                                <th>种菜笔数</th>
                                                <th>种菜金额</th>
                                                <th>全站推广</th>
                                                <th>关键词推广</th>
                                                <th>货品运营推广</th>
                                                <th>人群推广费用</th>
                                                <th>超级短视频</th>
                                                <th>多目标直投</th>
                                                <th>推广总金额</th>
                                                <th>推广占比</th>
                                                <th>数据记录数</th>
                                            </tr>
                                        </thead>
                                        <tbody id="operatorTableBody">
                                            <tr>
                                                <td colspan="21" class="text-center text-muted">
                                                    <i class="fas fa-spinner fa-spin"></i> 加载中...
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 类目业绩分布表格 -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-pie"></i> 类目业绩分布</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th style="width: 60px;">排名</th>
                                                <th style="width: 300px;">类目</th>
                                                <th style="width: 120px;">销售金额</th>
                                                <th style="width: 120px;">真实销售金额</th>
                                                <th style="width: 100px;">销售件数</th>
                                                <th style="width: 100px;">客单价</th>
                                                <th style="width: 100px;">访客数</th>
                                                <th style="width: 100px;">支付买家数</th>
                                                <th style="width: 100px;">支付转化率</th>
                                                <th style="width: 100px;">种菜笔数</th>
                                                <th style="width: 100px;">种菜金额</th>
                                                <th style="width: 100px;">全站推广</th>
                                                <th style="width: 100px;">关键词推广</th>
                                                <th style="width: 100px;">货品运营推广</th>
                                                <th style="width: 100px;">人群推广费用</th>
                                                <th style="width: 100px;">超级短视频</th>
                                                <th style="width: 100px;">多目标直投</th>
                                                <th style="width: 120px;">推广总金额</th>
                                                <th style="width: 100px;">数据记录数</th>
                                            </tr>
                                        </thead>
                                        <tbody id="categoryTableBody">
                                            <tr>
                                                <td colspan="19" class="text-center text-muted">
                                                    <i class="fas fa-spinner fa-spin"></i> 加载中...
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 数据列表页面 -->
            <div id="dataPage" class="page-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <h4><i class="fas fa-table"></i> 数据列表</h4>
                            </div>
                            <div class="col-md-9">
                                <div class="row g-2 align-items-end">
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">开始日期</label>
                                        <input type="date" class="form-control form-control-sm" id="uploadStartDateFilter" placeholder="开始日期">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">结束日期</label>
                                        <input type="date" class="form-control form-control-sm" id="uploadEndDateFilter" placeholder="结束日期">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">天猫ID</label>
                                        <input type="text" class="form-control form-control-sm" id="tmallProductCodeFilter" placeholder="输入天猫ID">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">产品名称</label>
                                        <input type="text" class="form-control form-control-sm" id="productNameFilter" placeholder="输入产品名称">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">店铺名</label>
                                        <select class="form-select form-select-sm" id="tmallSupplierNameFilter">
                                            <option value="">请选择店铺名</option>
                                            <option value="wugeng供应商">wugeng供应商</option>
                                            <option value="xizhen供应商">xizhen供应商</option>
                                            <option value="谦易律哲供应商">谦易律哲供应商</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-primary btn-sm" onclick="searchData()">
                                                <i class="fas fa-search"></i> 搜索
                                            </button>
                                            <button class="btn btn-outline-secondary btn-sm" onclick="clearFilters()">
                                                <i class="fas fa-times"></i> 清空
                                            </button>
                                            <button class="btn btn-outline-primary btn-sm" onclick="showColumnSelector()">
                                                <i class="fas fa-columns"></i> 列设置
                                            </button>
                                            <button class="btn btn-success btn-sm" onclick="exportDataToExcel()">
                                                <i class="fas fa-download"></i> 导出Excel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- 新版列选择器 -->
                        <div id="columnSelector" class="column-selector" style="display: none;">
                            <div class="search-box">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <h6 class="mb-0"><i class="fas fa-columns"></i> 列设置</h6>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control form-control-sm" id="columnSearchInput" 
                                               placeholder="搜索列名..." onkeyup="DataModule.filterColumns(this.value)">
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="min-height: 400px;">
                                <!-- 左侧分类列表 -->
                                <div class="col-md-6 category-section">
                                    <div class="p-3">
                                        <h6 class="text-muted mb-3">可选择列（按分类）</h6>
                                        <div id="categorizedColumns">
                                            <!-- 动态生成分类列表 -->
                                        </div>
                                    </div>
                                </div>
                                <!-- 右侧已选择列表 -->
                                <div class="col-md-6">
                                    <div class="p-3">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h6 class="text-muted mb-0">已选择列 (<span id="selectedCount">0</span>)</h6>
                                            <small class="text-muted">拖拽调整顺序</small>
                                        </div>
                                        <div id="frozenColumnsInfo" class="alert alert-light py-2 mb-3" style="font-size: 0.85rem;">
                                            <i class="fas fa-lock text-primary"></i> 
                                            <strong>冻结列：</strong>日期到链接负责人（固定显示，不可调整）
                                        </div>
                                        <div class="selected-columns" id="selectedColumnsList">
                                            <!-- 动态生成已选择列表 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="border-top p-3">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle"></i> 
                                            冻结列将始终显示在表格左侧
                                        </small>
                                    </div>
                                    <div class="col-md-6 text-end">
                                        <button class="btn btn-primary btn-sm" onclick="DataModule.applyColumnSettings()">
                                            <i class="fas fa-check"></i> 应用设置
                                        </button>
                                        <button class="btn btn-secondary btn-sm ms-2" onclick="DataModule.hideColumnSelector()">
                                            <i class="fas fa-times"></i> 取消
                                        </button>
                                        <button class="btn btn-outline-warning btn-sm ms-2" onclick="DataModule.resetColumns()">
                                            <i class="fas fa-undo"></i> 重置
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 表格容器 -->
                        <div class="table-container" style="overflow-x: auto; max-width: 100%; position: relative; background: white;">
                            <table class="table table-striped table-hover" id="dataTable" style="min-width: 1800px; border-collapse: separate; border-spacing: 0; background: white; table-layout: auto;">
                                <thead class="table-dark">
                                    <tr id="tableHeader">
                                        <!-- 表头将动态生成 -->
                                    </tr>
                                </thead>
                                <tbody id="dataTableBody">
                                    <!-- 数据将动态加载 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 加载提示 -->
                        <div id="loadingIndicator" class="text-center py-4" style="display: none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">加载中...</span>
                            </div>
                            <p class="mt-2">正在加载数据...</p>
                        </div>
                        
                        <!-- 分页控制 -->
                        <div class="row align-items-center mt-3">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <label class="form-label me-2 mb-0">每页显示:</label>
                                    <select class="form-select form-select-sm" id="pageSizeSelector" style="width: auto;">
                                        <option value="20" selected>20条</option>
                                        <option value="50">50条</option>
                                        <option value="100">100条</option>
                                    </select>
                                    <span class="ms-3 text-muted" id="dataInfo">显示 1-20 条，共 0 条</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <!-- 分页 -->
                                <nav>
                                    <ul class="pagination justify-content-end mb-0" id="pagination">
                                        <!-- 分页将动态生成 -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 订单数据列表页面 -->
            <div id="orderDataPage" class="page-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <h4><i class="fas fa-shopping-cart"></i> 订单数据列表</h4>
                            </div>
                            <div class="col-md-9">
                                <div class="row g-2 align-items-end">
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">开始日期</label>
                                        <input type="date" class="form-control form-control-sm" id="orderStartDateFilter" placeholder="选择开始日期">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">结束日期</label>
                                        <input type="date" class="form-control form-control-sm" id="orderEndDateFilter" placeholder="选择结束日期">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">店铺名称</label>
                                        <input type="text" class="form-control form-control-sm" id="orderStoreNameFilter" placeholder="输入店铺名称">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">操作人</label>
                                        <input type="text" class="form-control form-control-sm" id="orderOperatorFilter" placeholder="输入操作人">
                                    </div>
                                </div>
                                <div class="row g-2 align-items-end mt-2">
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">省份</label>
                                        <input type="text" class="form-control form-control-sm" id="orderProvinceFilter" placeholder="输入省份">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">城市</label>
                                        <input type="text" class="form-control form-control-sm" id="orderCityFilter" placeholder="输入城市">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">快递公司</label>
                                        <input type="text" class="form-control form-control-sm" id="orderExpressCompanyFilter" placeholder="输入快递公司">
                                    </div>
                                    <div class="col-md-6">
                                        <!-- 预留空间 -->
                                    </div>
                                </div>
                                <div class="row g-2 align-items-end mt-2">
                                    <div class="col-md-3">
                                        <label class="form-label mb-1" style="font-size: 0.875rem;">订单状态</label>
                                        <div class="dropdown">
                                            <button class="btn btn-outline-secondary btn-sm dropdown-toggle w-100" type="button" id="orderStatusDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                <span id="orderStatusSelected">选择状态</span>
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="orderStatusDropdown" style="max-height: 200px; overflow-y: auto; z-index: 1050;">
                                                <li><label class="dropdown-item"><input type="checkbox" value="取消" class="me-2"> 取消</label></li>
                                                <li><label class="dropdown-item"><input type="checkbox" value="已发货" class="me-2"> 已发货</label></li>
                                                <li><label class="dropdown-item"><input type="checkbox" value="发货后取消" class="me-2"> 发货后取消</label></li>
                                                <li><label class="dropdown-item"><input type="checkbox" value="外部发货" class="me-2"> 外部发货</label></li>
                                                <li><label class="dropdown-item"><input type="checkbox" value="线上发货" class="me-2"> 线上发货</label></li>
                                                <li><label class="dropdown-item"><input type="checkbox" value="None" class="me-2"> None</label></li>
                                                <li><label class="dropdown-item"><input type="checkbox" value="空白" class="me-2"> 空白</label></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="col-md-9">
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-primary btn-sm" onclick="OrderDataModule.searchOrderData()">
                                                <i class="fas fa-search"></i> 搜索
                                            </button>
                                            <button class="btn btn-outline-secondary btn-sm" onclick="OrderDataModule.clearOrderFilters()">
                                                <i class="fas fa-times"></i> 清空
                                            </button>
                                            <button class="btn btn-outline-primary btn-sm" onclick="OrderDataModule.showOrderColumnSelector()">
                                                <i class="fas fa-columns"></i> 列设置
                                            </button>
                                            <button class="btn btn-success btn-sm" onclick="OrderDataModule.exportOrderDataToExcel()">
                                                <i class="fas fa-download"></i> 导出Excel
                                            </button>
                                            <button class="btn btn-info btn-sm" onclick="OrderDataModule.testOrderStatusFilter()" title="调试订单状态筛选">
                                                <i class="fas fa-bug"></i> 调试
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- 新版列选择器 -->
                        <div id="orderColumnSelector" class="column-selector" style="display: none;">
                            <div class="search-box">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <h6 class="mb-0"><i class="fas fa-columns"></i> 列设置</h6>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control form-control-sm" id="orderColumnSearchInput" 
                                               placeholder="搜索列名..." onkeyup="OrderDataModule.filterColumns(this.value)">
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="min-height: 400px;">
                                <!-- 左侧分类列表 -->
                                <div class="col-md-6 category-section">
                                    <div class="p-3">
                                        <h6 class="text-muted mb-3">可选择列（按分类）</h6>
                                        <div id="orderCategorizedColumns">
                                            <!-- 动态生成分类列表 -->
                                        </div>
                                    </div>
                                </div>
                                <!-- 右侧已选择列表 -->
                                <div class="col-md-6">
                                    <div class="p-3">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h6 class="text-muted mb-0">已选择列 (<span id="orderSelectedCount">0</span>)</h6>
                                            <small class="text-muted">拖拽调整顺序</small>
                                        </div>
                                        <div class="selected-columns" id="orderSelectedColumnsList">
                                            <!-- 动态生成已选择列表 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="border-top p-3">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle"></i> 
                                            拖拽右侧列表项可调整显示顺序
                                        </small>
                                    </div>
                                    <div class="col-md-6 text-end">
                                        <button class="btn btn-primary btn-sm" onclick="OrderDataModule.applyOrderColumnSettings()">
                                            <i class="fas fa-check"></i> 应用设置
                                        </button>
                                        <button class="btn btn-secondary btn-sm ms-2" onclick="OrderDataModule.hideOrderColumnSelector()">
                                            <i class="fas fa-times"></i> 取消
                                        </button>
                                        <button class="btn btn-outline-warning btn-sm ms-2" onclick="OrderDataModule.resetOrderColumns()">
                                            <i class="fas fa-undo"></i> 重置
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 表格容器 -->
                        <div class="table-container" style="overflow-x: auto; max-width: 100%;">
                            <table class="table table-striped table-hover" id="orderDataTable" style="min-width: 1200px;">
                                <thead class="table-dark sticky-top">
                                    <tr id="orderTableHeader">
                                        <!-- 表头将动态生成 -->
                                    </tr>
                                </thead>
                                <tbody id="orderDataTableBody">
                                    <!-- 数据将动态加载 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 加载提示 -->
                        <div id="orderLoadingIndicator" class="text-center py-4" style="display: none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">加载中...</span>
                            </div>
                            <p class="mt-2">正在加载订单数据...</p>
                        </div>
                        
                        <!-- 分页控制 -->
                        <div class="row align-items-center mt-3">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <label class="form-label me-2 mb-0">每页显示:</label>
                                    <select class="form-select form-select-sm" id="orderPageSizeSelector" style="width: auto;">
                                        <option value="20" selected>20条</option>
                                        <option value="50">50条</option>
                                        <option value="100">100条</option>
                                    </select>
                                    <span class="ms-3 text-muted" id="orderDataInfo">显示 1-20 条，共 0 条</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <!-- 分页 -->
                                <nav>
                                    <ul class="pagination justify-content-end mb-0" id="orderPagination">
                                        <!-- 分页将动态生成 -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 商品趋势弹窗 -->
    <div class="modal fade" id="productTrendModal" tabindex="-1" aria-labelledby="productTrendModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productTrendModalLabel">
                        <i class="fas fa-chart-line text-primary"></i> 
                        商品趋势分析 - <span id="trendProductCode"></span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- 商品基本信息 -->
                    <div class="mb-3">
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-1"><strong>商品名称：</strong><span id="trendProductName">-</span></p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-1"><strong>数据时间范围：</strong><span id="trendDateRange">-</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 日期区间选择 -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-calendar-alt text-primary"></i> 自定义时间范围
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="trendStartDate" class="form-label">开始日期</label>
                                    <input type="date" class="form-control" id="trendStartDate">
                                </div>
                                <div class="col-md-4">
                                    <label for="trendEndDate" class="form-label">结束日期</label>
                                    <input type="date" class="form-control" id="trendEndDate">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">&nbsp;</label>
                                    <div>
                                        <button class="btn btn-primary" onclick="TrendModule.loadCustomDateRange()">
                                            <i class="fas fa-search"></i> 查询
                                        </button>
                                        <button class="btn btn-outline-secondary ms-2" onclick="TrendModule.resetToDefault()">
                                            <i class="fas fa-undo"></i> 重置
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle"></i> 
                                    默认显示最近30天数据，可自定义查询范围（最大365天）
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 字段选择器 -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-check-square text-success"></i> 选择对比指标
                                <small class="text-muted ms-2">(最多选择2个)</small>
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info py-2 mb-3" style="font-size: 0.875rem;">
                                <i class="fas fa-info-circle"></i>
                                <strong>双轴对比：</strong>选择2个指标时，左轴显示第1个指标，右轴显示第2个指标，便于不同量级数据的对比分析
                            </div>
                            <div class="row" id="trendFieldSelector">
                                <!-- 字段选择器将动态生成 -->
                            </div>
                            <div class="mt-2">
                                <button class="btn btn-sm btn-outline-primary" onclick="selectAllTrendFields()">
                                    <i class="fas fa-check"></i> 选择前2个
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="resetTrendFields()">
                                    <i class="fas fa-undo"></i> 重置
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="updateTrendChart()">
                                    <i class="fas fa-chart-line"></i> 更新图表
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 趋势图表 -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-chart-area text-info"></i> 趋势图表 <span id="trendChartTitle">（最近30天）</span>
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="position-relative" style="height: 400px;">
                                <canvas id="productTrendChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- 统计汇总 -->
                    <div class="card" id="trendSummaryCard" style="display: none;">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-calculator text-success"></i> 统计汇总 <span id="summaryDateRange">（所选日期范围）</span>
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row" id="trendSummaryContent">
                                <!-- 统计数据将动态生成 -->
                            </div>
                            <div class="mt-3">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle"></i> 
                                    此处显示所选字段在日期范围内的汇总统计，百分比类字段不参与汇总计算
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- 推广汇总 -->
                    <div class="card" id="promotionSummaryCard" style="display: none;">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-ad text-warning"></i> 推广汇总 <span id="promotionDateRange">（所选日期范围）</span>
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row" id="promotionSummaryContent">
                                <!-- 推广汇总数据将动态生成 -->
                            </div>
                            <div class="mt-3">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle"></i> 
                                    此处显示所选日期范围内的各项推广费用汇总
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="exportTrendData()">
                        <i class="fas fa-download"></i> 导出数据
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 主体报表弹窗 -->
    <div class="modal fade" id="subjectReportModal" tabindex="-1" aria-labelledby="subjectReportModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="subjectReportModalLabel">
                        <i class="fas fa-chart-bar text-warning"></i> 
                        主体报表数据 - <span id="subjectReportProductCode"></span> - <span id="subjectReportPromotionType"></span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- 商品基本信息 -->
                    <div class="mb-3">
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-1"><strong>商品名称：</strong><span id="subjectReportProductName">-</span></p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-1"><strong>数据时间范围：</strong><span id="subjectReportDateRange">-</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 数据统计 -->
                    <div class="card mb-4" id="subjectReportSummary" style="display: none;">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-chart-pie text-info"></i> 数据统计
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h4 class="text-primary" id="summaryTotalCost">¥0.00</h4>
                                        <small class="text-muted">总花费</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h4 class="text-success" id="summaryTotalImpressions">0</h4>
                                        <small class="text-muted">总展现量</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h4 class="text-info" id="summaryTotalClicks">0</h4>
                                        <small class="text-muted">总点击量</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h4 class="text-warning" id="summaryTotalTransactionAmount">¥0.00</h4>
                                        <small class="text-muted">总成交金额</small>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h5 class="text-secondary" id="summaryTotalTransactionOrders">0</h5>
                                        <small class="text-muted">总成交笔数</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h5 class="text-secondary" id="summaryAvgCtr">0.00%</h5>
                                        <small class="text-muted">平均点击率</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h5 class="text-secondary" id="summaryAvgCpc">¥0.00</h5>
                                        <small class="text-muted">平均点击花费</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h5 class="text-secondary" id="summaryAvgRoas">0.00</h5>
                                        <small class="text-muted">平均投入产出比</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 数据表格 -->
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-table text-primary"></i> 主体报表详细数据
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
                                <table class="table table-striped table-hover table-sm">
                                    <thead class="table-dark sticky-top">
                                        <tr>
                                            <th>日期</th>
                                            <th>场景名字</th>
                                            <th>原二级场景名字</th>
                                            <th>计划ID</th>
                                            <th>计划名字</th>
                                            <th>主体ID</th>
                                            <th>展现量</th>
                                            <th>点击量</th>
                                            <th>花费</th>
                                            <th>点击率</th>
                                            <th>平均点击花费</th>
                                            <th>千次展现花费</th>
                                            <th>直接成交金额</th>
                                            <th>间接成交金额</th>
                                            <th>总成交金额</th>
                                            <th>总成交笔数</th>
                                            <th>直接成交笔数</th>
                                            <th>间接成交笔数</th>
                                            <th>点击转化率</th>
                                            <th>投入产出比</th>
                                            <th>总成交成本</th>
                                            <th>总购物车数</th>
                                            <th>直接购物车数</th>
                                            <th>间接购物车数</th>
                                            <th>加购率</th>
                                            <th>收藏宝贝数</th>
                                            <th>收藏店铺数</th>
                                            <th>店铺收藏成本</th>
                                            <th>总收藏加购数</th>
                                            <th>总收藏加购成本</th>
                                            <th>宝贝收藏加购数</th>
                                            <th>宝贝收藏加购成本</th>
                                            <th>总收藏数</th>
                                            <th>宝贝收藏成本</th>
                                            <th>宝贝收藏率</th>
                                            <th>加购成本</th>
                                            <th>拍下订单笔数</th>
                                            <th>拍下订单金额</th>
                                            <th>直接收藏宝贝数</th>
                                            <th>间接收藏宝贝数</th>
                                            <th>旺旺咨询量</th>
                                            <th>引导访问量</th>
                                            <th>引导访问人数</th>
                                            <th>引导访问潜客数</th>
                                            <th>引导访问潜客占比</th>
                                            <th>引导访问率</th>
                                            <th>深度访问量</th>
                                            <th>平均访问页面数</th>
                                            <th>成交新客数</th>
                                            <th>成交新客占比</th>
                                            <th>会员首购人数</th>
                                            <th>会员成交金额</th>
                                            <th>会员成交笔数</th>
                                            <th>成交人数</th>
                                            <th>人均成交笔数</th>
                                            <th>人均成交金额</th>
                                            <th>自然流量转化金额</th>
                                            <th>自然流量曝光量</th>
                                        </tr>
                                    </thead>
                                    <tbody id="subjectReportTableBody">
                                        <!-- 数据将动态生成 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="exportSubjectReportData()">
                        <i class="fas fa-download"></i> 导出数据
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载提示 -->
    <div class="position-fixed top-50 start-50 translate-middle" id="loadingSpinner" style="display: none; z-index: 9999;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- 店铺信息弹窗 -->
    <div class="modal fade" id="storeInfoModal" tabindex="-1" aria-labelledby="storeInfoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="storeInfoModalLabel">
                        <i class="fas fa-store text-primary"></i> 
                        店铺汇总信息 - <span id="storeModalName">-</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- 店铺基本信息 -->
                    <div class="mb-3">
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-1"><strong>店铺名称：</strong><span id="storeModalStoreName">-</span></p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-1"><strong>统计日期：</strong><span id="storeModalDate">-</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 汇总数据展示 -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card text-center border-primary">
                                <div class="card-body">
                                    <i class="fas fa-shopping-bag fa-2x text-primary mb-2"></i>
                                    <h4 class="text-primary" id="storeModalOrderCount">0</h4>
                                    <small>订单数量</small>
                                    <p class="text-muted small mb-0">去重后的线上订单号数量</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center border-success">
                                <div class="card-body">
                                    <i class="fas fa-money-bill-wave fa-2x text-success mb-2"></i>
                                    <h4 class="text-success">¥<span id="storeModalTotalSales">0.00</span></h4>
                                    <small>销售金额</small>
                                    <p class="text-muted small mb-0">所有商品金额的累加</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center border-warning">
                                <div class="card-body">
                                    <i class="fas fa-calculator fa-2x text-warning mb-2"></i>
                                    <h4 class="text-warning">¥<span id="storeModalTotalCost">0.00</span></h4>
                                    <small>总成本</small>
                                    <p class="text-muted small mb-0">运营成本供货价×数量的累加</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center border-info">
                                <div class="card-body">
                                    <i class="fas fa-chart-line fa-2x text-info mb-2"></i>
                                    <h4 class="text-info">¥<span id="storeModalProfit">0.00</span></h4>
                                    <small>利润</small>
                                    <p class="text-muted small mb-0">销售金额 - 总成本</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 利润率指标 -->
                    <div class="mt-4">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">利润率</h5>
                                        <div class="progress mb-2" style="height: 20px;">
                                            <div class="progress-bar bg-info" id="storeProfitRateBar" role="progressbar" style="width: 0%">
                                                <span id="storeModalProfitRate">0%</span>
                                            </div>
                                        </div>
                                        <small class="text-muted">利润 ÷ 销售金额 × 100%</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">平均订单金额</h5>
                                        <h4 class="text-primary">¥<span id="storeModalAvgOrderAmount">0.00</span></h4>
                                        <small class="text-muted">销售金额 ÷ 订单数量</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 加载状态 -->
                    <div id="storeInfoLoading" class="text-center py-4" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">加载中...</span>
                        </div>
                        <p class="mt-2">正在加载店铺汇总信息...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 操作人信息弹窗 -->
    <div class="modal fade" id="operatorInfoModal" tabindex="-1" aria-labelledby="operatorInfoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="operatorInfoModalLabel">
                        <i class="fas fa-user text-primary"></i> 
                        操作人汇总信息 - <span id="operatorModalName">-</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- 操作人基本信息 -->
                    <div class="mb-3">
                        <div class="row">
                            <div class="col-md-4">
                                <p class="mb-1"><strong>操作人：</strong><span id="operatorModalOperatorName">-</span></p>
                            </div>
                            <div class="col-md-4">
                                <p class="mb-1"><strong>店铺名称：</strong><span id="operatorModalStoreName">-</span></p>
                            </div>
                            <div class="col-md-4">
                                <p class="mb-1"><strong>统计日期：</strong><span id="operatorModalDate">-</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 汇总数据展示 -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card text-center border-primary">
                                <div class="card-body">
                                    <i class="fas fa-shopping-bag fa-2x text-primary mb-2"></i>
                                    <h4 class="text-primary" id="operatorModalOrderCount">0</h4>
                                    <small>订单数量</small>
                                    <p class="text-muted small mb-0">去重后的线上订单号数量</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center border-success">
                                <div class="card-body">
                                    <i class="fas fa-money-bill-wave fa-2x text-success mb-2"></i>
                                    <h4 class="text-success">¥<span id="operatorModalTotalSales">0.00</span></h4>
                                    <small>销售金额</small>
                                    <p class="text-muted small mb-0">所有商品金额的累加</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center border-warning">
                                <div class="card-body">
                                    <i class="fas fa-calculator fa-2x text-warning mb-2"></i>
                                    <h4 class="text-warning">¥<span id="operatorModalTotalCost">0.00</span></h4>
                                    <small>总成本</small>
                                    <p class="text-muted small mb-0">运营成本供货价×数量的累加</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center border-info">
                                <div class="card-body">
                                    <i class="fas fa-chart-line fa-2x text-info mb-2"></i>
                                    <h4 class="text-info">¥<span id="operatorModalProfit">0.00</span></h4>
                                    <small>利润</small>
                                    <p class="text-muted small mb-0">销售金额 - 总成本</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 利润率指标 -->
                    <div class="mt-4">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">利润率</h5>
                                        <div class="progress mb-2" style="height: 20px;">
                                            <div class="progress-bar bg-info" id="operatorProfitRateBar" role="progressbar" style="width: 0%">
                                                <span id="operatorModalProfitRate">0%</span>
                                            </div>
                                        </div>
                                        <small class="text-muted">利润 ÷ 销售金额 × 100%</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">平均订单金额</h5>
                                        <h4 class="text-primary">¥<span id="operatorModalAvgOrderAmount">0.00</span></h4>
                                        <small class="text-muted">销售金额 ÷ 订单数量</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 加载状态 -->
                    <div id="operatorInfoLoading" class="text-center py-4" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">加载中...</span>
                        </div>
                        <p class="mt-2">正在加载操作人汇总信息...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 订单详情弹窗 -->
    <div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-labelledby="orderDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="orderDetailsModalLabel">
                        <i class="fas fa-file-alt text-primary"></i> 
                        订单详情 - <span id="orderDetailsModalTitle">-</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- 订单基本信息 -->
                    <div class="mb-3">
                        <div class="row">
                            <div class="col-md-3">
                                <p class="mb-1"><strong>内部订单号：</strong><span id="orderDetailsModalInternalNumber">-</span></p>
                            </div>
                            <div class="col-md-3">
                                <p class="mb-1"><strong>店铺名称：</strong><span id="orderDetailsModalStoreName">-</span></p>
                            </div>
                            <div class="col-md-3">
                                <p class="mb-1"><strong>下单时间：</strong><span id="orderDetailsModalOrderTime">-</span></p>
                            </div>
                            <div class="col-md-3">
                                <p class="mb-1"><strong>商品数量：</strong><span id="orderDetailsModalItemCount">-</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 汇总信息 -->
                    <div class="row mb-4 justify-content-center">
                        <div class="col-lg-8 col-xl-6">
                            <div class="row">
                                <div class="col-4">
                                    <div class="card text-center border-success h-100">
                                        <div class="card-body py-3">
                                            <i class="fas fa-money-bill-wave fa-lg text-success mb-1"></i>
                                            <h5 class="text-success mb-1">¥<span id="orderDetailsModalSalesAmount">0.00</span></h5>
                                            <small class="text-muted">销售金额</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="card text-center border-warning h-100">
                                        <div class="card-body py-3">
                                            <i class="fas fa-calculator fa-lg text-warning mb-1"></i>
                                            <h5 class="text-warning mb-1">¥<span id="orderDetailsModalTotalCost">0.00</span></h5>
                                            <small class="text-muted">总成本</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="card text-center border-info h-100">
                                        <div class="card-body py-3">
                                            <i class="fas fa-chart-line fa-lg text-info mb-1"></i>
                                            <h5 class="text-info mb-1">¥<span id="orderDetailsModalProfit">0.00</span></h5>
                                            <small class="text-muted">利润</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 商品详情表格 -->
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>商品编码</th>
                                    <th>商品名称</th>
                                    <th>数量</th>
                                    <th>运营成本供货价</th>
                                    <th>小计成本</th>
                                </tr>
                            </thead>
                            <tbody id="orderDetailsModalTableBody">
                                <!-- 数据将动态加载 -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- 加载状态 -->
                    <div id="orderDetailsLoading" class="text-center py-4" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">加载中...</span>
                        </div>
                        <p class="mt-2">正在加载订单详情...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 商品销售排行模态框 -->
    <div class="modal fade" id="productRankingModal" tabindex="-1" aria-labelledby="productRankingModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productRankingModalTitle">商品销售排行</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- 商品销售排行表格 -->
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>排名</th>
                                    <th>商品ID</th>
                                    <th>商品名称</th>
                                    <th class="sort-header" data-sort-by="total_amount" style="cursor: pointer;">
                                        销售金额 <i class="fas fa-sort text-muted"></i>
                                    </th>
                                    <th class="sort-header" data-sort-by="real_amount" style="cursor: pointer;">
                                        真实销售金额 <i class="fas fa-sort-down text-primary"></i>
                                    </th>
                                    <th class="sort-header" data-sort-by="total_quantity" style="cursor: pointer;">
                                        销售件数 <i class="fas fa-sort text-muted"></i>
                                    </th>
                                    <th>退款金额</th>
                                    <th>种菜金额</th>
                                </tr>
                            </thead>
                            <tbody id="productRankingTableBody">
                                <!-- 数据将动态加载 -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- 分页 -->
                    <div id="productRankingPagination" class="mt-3">
                        <!-- 分页将动态加载 -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 使用多个CDN作为备用 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    
    <!-- Chart.js with multiple CDN fallbacks and local backup -->
    <script>
        // Chart.js 加载失败时的备用方案
        function loadChartJS() {
            const cdnUrls = [
                'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js',
                'https://unpkg.com/chart.js@3.9.1/dist/chart.min.js',
                'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js',
                'js/libs/chart.min.js'  // 本地备用文件
            ];
            
            function tryLoadChart(index) {
                if (index >= cdnUrls.length) {
                    console.error('所有Chart.js源都加载失败，包括本地文件');
                    // 显示用户友好的错误提示
                    if (typeof showAlert === 'function') {
                        showAlert('图表组件加载失败，页面功能可能受限。建议刷新页面或联系管理员。', 'error');
                    }
                    return;
                }
                
                const script = document.createElement('script');
                script.src = cdnUrls[index];
                script.onload = function() {
                    const source = index < 3 ? 'CDN' : '本地文件';
                    console.log('Chart.js加载成功，来源:', source, cdnUrls[index]);
                    
                    // 检查Chart对象是否正确加载
                    if (typeof Chart !== 'undefined') {
                        console.log('Chart.js初始化成功');
                        // 触发自定义事件，通知其他模块Chart.js已就绪
                        window.dispatchEvent(new CustomEvent('chartjs-loaded'));
                    }
                };
                script.onerror = function() {
                    const source = index < 3 ? 'CDN' : '本地文件';
                    console.warn('Chart.js加载失败，尝试下一个源:', source, cdnUrls[index]);
                    tryLoadChart(index + 1);
                };
                document.head.appendChild(script);
            }
            
            tryLoadChart(0);
        }
        
        // 立即加载Chart.js
        loadChartJS();
    </script>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/modules/auth.js"></script>
    <script src="js/modules/upload.js"></script>
    <script src="js/modules/data.js"></script>
    <script src="js/modules/router.js"></script>
    <script src="js/modules/productRanking.js"></script>
    <script src="js/modules/subjectReport.js"></script>
    <script src="js/modules/charts.js"></script>
    <script src="js/modules/summary.js"></script>
    <script src="js/modules/planting.js"></script>
<script src="js/modules/orderDetails.js"></script>
<script src="js/modules/final.js"></script>
    <script src="js/modules/trend.js"></script>
    <script src="js/modules/orderData.js"></script>
    <script src="js/modules/productTags.js"></script>
    <script src="app.js"></script>
</body>
</html> 
</html> 