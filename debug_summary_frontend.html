<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据汇总功能调试</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h4><i class="fas fa-bug"></i> 数据汇总功能调试工具</h4>
                        <p class="mb-0">快速测试前端事件绑定和API调用</p>
                    </div>
                    <div class="card-body">
                        <!-- 步骤指南 -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5><i class="fas fa-list-ol"></i> 调试步骤</h5>
                                <ol>
                                    <li class="mb-2"><strong>打开主系统：</strong> 
                                        <a href="http://localhost:8080" target="_blank" class="btn btn-sm btn-primary">
                                            <i class="fas fa-external-link-alt"></i> 打开主系统
                                        </a>
                                    </li>
                                    <li class="mb-2"><strong>登录管理员账户：</strong> admin / admin123</li>
                                    <li class="mb-2"><strong>点击"数据汇总"TAB</strong></li>
                                    <li class="mb-2"><strong>打开浏览器开发者工具</strong> (F12)</li>
                                    <li class="mb-2"><strong>查看控制台日志</strong>（应该看到事件监听器设置的日志）</li>
                                    <li class="mb-2"><strong>点击"开始计算汇总"按钮</strong></li>
                                    <li class="mb-2"><strong>检查是否有API调用</strong>（网络选项卡或控制台）</li>
                                </ol>
                            </div>
                        </div>

                        <!-- 预期日志输出 -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5><i class="fas fa-terminal"></i> 预期控制台日志</h5>
                                <div class="alert alert-secondary">
                                    <pre><code>正在设置数据汇总事件监听器...
数据汇总元素检查: {summaryDate: true, calculateBtn: true}
设置默认日期: 2025-01-08
数据汇总日期选择器事件监听器已设置
数据汇总计算按钮事件监听器已设置
数据汇总事件监听器设置完成</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- 点击按钮时的日志 -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5><i class="fas fa-mouse-pointer"></i> 点击按钮时的预期日志</h5>
                                <div class="alert alert-success">
                                    <pre><code>handleCalculateSummary 函数被调用
选择的日期: 2025-01-08
开始计算 2025-01-08 的汇总数据</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- API测试工具 -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5><i class="fas fa-code"></i> 直接API测试</h5>
                                <p>如果前端按钮不工作，可以在浏览器控制台直接运行以下代码：</p>
                                <div class="card bg-dark text-light">
                                    <div class="card-body">
                                        <code>
// 手动调用汇总计算函数<br>
if (typeof handleCalculateSummary === 'function') {<br>
&nbsp;&nbsp;&nbsp;&nbsp;console.log('函数存在，开始调用');<br>
&nbsp;&nbsp;&nbsp;&nbsp;handleCalculateSummary();<br>
} else {<br>
&nbsp;&nbsp;&nbsp;&nbsp;console.error('handleCalculateSummary 函数不存在！');<br>
}
                                        </code>
                                    </div>
                                </div>
                                <button class="btn btn-info mt-2" onclick="copyToClipboard()">
                                    <i class="fas fa-copy"></i> 复制代码到剪贴板
                                </button>
                            </div>
                        </div>

                        <!-- 常见问题 -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5><i class="fas fa-question-circle"></i> 常见问题排查</h5>
                                <div class="accordion" id="troubleshootAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingOne">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                                ❌ 控制台没有看到事件监听器日志
                                            </button>
                                        </h2>
                                        <div id="collapseOne" class="accordion-collapse collapse show">
                                            <div class="accordion-body">
                                                <ul>
                                                    <li>检查是否已经登录管理员账户</li>
                                                    <li>确认点击了"数据汇总"TAB</li>
                                                    <li>刷新页面并重新登录</li>
                                                    <li>清除浏览器缓存</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingTwo">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                                ❌ 点击按钮没有反应
                                            </button>
                                        </h2>
                                        <div id="collapseTwo" class="accordion-collapse collapse">
                                            <div class="accordion-body">
                                                <ul>
                                                    <li>检查按钮是否已启用（不是灰色状态）</li>
                                                    <li>确认已选择日期</li>
                                                    <li>在控制台运行上面的测试代码</li>
                                                    <li>检查是否有JavaScript错误</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingThree">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                                ❌ 函数被调用但没有API请求
                                            </button>
                                        </h2>
                                        <div id="collapseThree" class="accordion-collapse collapse">
                                            <div class="accordion-body">
                                                <ul>
                                                    <li>检查网络连接</li>
                                                    <li>确认后端服务正常运行</li>
                                                    <li>查看网络选项卡的失败请求</li>
                                                    <li>检查JWT令牌是否有效</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 状态检查 -->
                        <div class="row">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-info-circle"></i> 系统状态检查</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>前端服务：</strong> <span id="frontendStatus">检查中...</span></p>
                                            <p><strong>后端API：</strong> <span id="backendStatus">检查中...</span></p>
                                        </div>
                                        <div class="col-md-6">
                                            <button class="btn btn-outline-primary" onclick="checkSystemStatus()">
                                                <i class="fas fa-sync"></i> 检查系统状态
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // 复制代码到剪贴板
        function copyToClipboard() {
            const code = `// 手动调用汇总计算函数
if (typeof handleCalculateSummary === 'function') {
    console.log('函数存在，开始调用');
    handleCalculateSummary();
} else {
    console.error('handleCalculateSummary 函数不存在！');
}`;
            
            navigator.clipboard.writeText(code).then(() => {
                showAlert('代码已复制到剪贴板！', 'success');
            });
        }

        // 检查系统状态
        async function checkSystemStatus() {
            // 检查前端服务
            try {
                const response = await fetch('http://localhost:8080/index.html');
                document.getElementById('frontendStatus').innerHTML = response.ok ? 
                    '<span class="text-success">✅ 正常</span>' : 
                    '<span class="text-danger">❌ 异常</span>';
            } catch (error) {
                document.getElementById('frontendStatus').innerHTML = '<span class="text-danger">❌ 无法连接</span>';
            }

            // 检查后端API
            try {
                const response = await fetch('http://localhost:5000/health');
                document.getElementById('backendStatus').innerHTML = response.ok ? 
                    '<span class="text-success">✅ 正常</span>' : 
                    '<span class="text-danger">❌ 异常</span>';
            } catch (error) {
                document.getElementById('backendStatus').innerHTML = '<span class="text-danger">❌ 无法连接</span>';
            }
        }

        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '9999';
            alert.innerHTML = `${message}<button type="button" class="btn-close" data-bs-dismiss="alert"></button>`;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 3000);
        }

        // 页面加载时检查系统状态
        document.addEventListener('DOMContentLoaded', checkSystemStatus);
    </script>
</body>
</html> 